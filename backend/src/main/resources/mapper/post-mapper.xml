<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.community.backend.post.dao.PostDao">

	<insert id="insertPost" parameterType="postDTO">
		INSERT INTO POST (
		POST_ID,
		CATEGORY_ID,
		AUTHOR_ID,
		TITLE,
		CONTENT,
		VIEW_COUNT,
		LIKE_COUNT,
		COMMENT_COUNT,
		IS_DELETED,
		CREATED_AT,
		UPDATED_AT
		) VALUES (
		POST_SEQ.NEXTVAL,
		#{categoryId},
		#{authorId},
		#{title},
		#{content},
		#{viewCount},
		#{likeCount},
		#{commentCount},
		#{isDeleted},
		SYSDATE,
		SYSDATE
		)
	</insert>

	<select id="selectPostById" resultType="postDTO">
		SELECT
		POST_ID AS postId,
		CATEGORY_ID AS categoryId,
		AUTHOR_ID AS authorId,
		TITLE AS title,
		CONTENT AS content,
		VIEW_COUNT AS viewCount,
		LIKE_COUNT AS likeCount,
		COMMENT_COUNT AS commentCount,
		IS_DELETED AS isDeleted,
		CREATED_AT AS createdAt,
		UPDATED_AT AS updatedAt
		FROM POST
		WHERE POST_ID = #{postId}
		AND IS_DELETED = 'N'
	</select>
	<select id="selectPostSeqCurrval" resultType="long">
		SELECT
		POST_SEQ.CURRVAL FROM DUAL
	</select>

	<!-- ✅ 글 수정 (삭제된 글은 수정 불가) -->
	<update id="updatePost" parameterType="postDTO">
		UPDATE POST
		SET CATEGORY_ID
		= #{categoryId},
		TITLE = #{title},
		CONTENT = #{content},
		UPDATED_AT =
		SYSDATE
		WHERE POST_ID = #{postId}
		AND IS_DELETED = 'N'
	</update>

	<!-- ✅ 글 삭제 (소프트 삭제) -->
	<update id="deletePost" parameterType="map">
		UPDATE POST
		SET IS_DELETED
		= 'Y',
		UPDATED_AT = SYSDATE
		WHERE POST_ID = #{postId}
		AND IS_DELETED =
		'N'
	</update>

</mapper>
