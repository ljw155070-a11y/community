<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.co.community.backend.alert.dao.AlertDao">

    <!-- 알림 저장 -->
    <insert id="saveAlert" parameterType="kr.co.community.backend.alert.dto.AlertDTO">
        INSERT INTO ALERT (
            ALERT_ID,
            MEMBER_ID,
            ALERT_TYPE,
            CONTENT,
            RELATED_POST_ID,
            RELATED_COMMENT_ID,
            IS_READ,
            CREATED_AT
        ) VALUES (
            ALERT_SEQ.NEXTVAL,
            #{memberId},
            #{alertType},
            #{content},
            #{relatedPostId},
            #{relatedCommentId},
            'N',
            SYSDATE
        )
    </insert>

    <!-- 회원별 알림 목록 조회 -->
    <select id="getAlertList" parameterType="int" resultType="kr.co.community.backend.alert.dto.AlertDTO">
        SELECT 
            ALERT_ID as alertId,
            MEMBER_ID as memberId,
            ALERT_TYPE as alertType,
            CONTENT as content,
            RELATED_POST_ID as relatedPostId,
            RELATED_COMMENT_ID as relatedCommentId,
            IS_READ as isRead,
            CREATED_AT as createdAt
        FROM ALERT
        WHERE MEMBER_ID = #{memberId}
        ORDER BY CREATED_AT DESC
    </select>

    <!-- 알림 읽음 처리 -->
    <update id="updateRead" parameterType="int">
        UPDATE ALERT
        SET IS_READ = 'Y'
        WHERE ALERT_ID = #{alertId}
    </update>

    <!-- 안읽은 알림 개수 조회 -->
    <select id="getUnreadCount" parameterType="int" resultType="int">
        SELECT COUNT(*)
        FROM ALERT
        WHERE MEMBER_ID = #{memberId}
        AND IS_READ = 'N'
    </select>

</mapper>