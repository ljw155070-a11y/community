<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.co.community.backend.member.dao.MemberDao">


  <!-- 이메일 중복 체크 -->
  <select id="countByEmail" parameterType="string" resultType="int">
    SELECT COUNT(*)
    FROM MEMBER
    WHERE EMAIL = #{email}
  </select>
  
    <select id="countByNickname" resultType="int">
    SELECT COUNT(*)
    FROM MEMBER
    WHERE NICKNAME = #{nickname}
  </select>

  <!--
    base = '홍길동'
    조회 대상: '홍길동#0001', '홍길동#0002' ...
    그 중 최대 숫자(예: 12)를 반환
  -->
  <select id="selectMaxNicknameSuffix" resultType="int">
    SELECT NVL(MAX(TO_NUMBER(SUBSTR(NICKNAME, LENGTH(#{base}) + 2))), 0)
    FROM MEMBER
    WHERE NICKNAME LIKE #{base} || '#____'
  </select>

  <!-- 회원가입 -->
  <insert id="insertMember" parameterType="member">
  INSERT INTO MEMBER (
    MEMBER_ID, EMAIL, PASSWORD_HASH, NAME, NICKNAME, ROLE, STATUS, CREATED_AT
  ) VALUES (
    MEMBER_SEQ.NEXTVAL,
    #{email},
    #{passwordHash},
    #{name},
    #{nickname},
    #{role},
    #{status},
    SYSDATE
  )
  </insert>
</mapper>