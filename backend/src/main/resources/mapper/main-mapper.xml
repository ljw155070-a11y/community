<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.co.community.backend.main.dao.MainDao">

<!-- 조회수 TOP 4 -->
<select id="getViewTopPosts" resultType="post">
    SELECT * FROM (
        SELECT p.title, m.nickname, c.category_name, p.view_count, p.like_count, p.comment_count, p.created_at, p.post_id
        FROM post p
        JOIN member m ON p.author_id = m.member_id
        JOIN board_category c ON p.category_id = c.category_id
        WHERE p.is_deleted = 'N'
        ORDER BY p.view_count DESC
    ) WHERE ROWNUM <![CDATA[<=]]> 4
</select>

<!-- 좋아요 TOP 4 -->
<select id="getLikeTopPosts" resultType="post">
    SELECT * FROM (
        SELECT p.title, m.nickname, c.category_name, p.view_count, p.like_count, p.comment_count, p.created_at, p.post_id
        FROM post p
        JOIN member m ON p.author_id = m.member_id
        JOIN board_category c ON p.category_id = c.category_id
        WHERE p.is_deleted = 'N'
        ORDER BY p.like_count DESC
    ) WHERE ROWNUM <![CDATA[<=]]> 4
</select>

<!-- 댓글 TOP 4 -->
<select id="getCommentTopPosts" resultType="post">
    SELECT * FROM (
        SELECT p.title, m.nickname, c.category_name, p.view_count, p.like_count, p.comment_count, p.created_at, p.post_id
        FROM post p
        JOIN member m ON p.author_id = m.member_id
        JOIN board_category c ON p.category_id = c.category_id
        WHERE p.is_deleted = 'N'
        ORDER BY p.comment_count DESC
    ) WHERE ROWNUM <![CDATA[<=]]> 4
</select>

<!-- 공지사항 목록 -->
<select id="getNoticeList" resultType="notice">
    SELECT * FROM (
        SELECT notice_id, notice_type, title, created_at
        FROM notice
        ORDER BY created_at DESC
    ) WHERE ROWNUM <![CDATA[<=]]> 10
</select>

<!-- 카테고리별 최신 게시글 5개 -->
<select id="getRecentPostsByCategory" resultType="post">
    SELECT * FROM (
        SELECT p.title, m.nickname, c.category_name, p.view_count, p.like_count, p.comment_count, p.created_at, p.post_id
        FROM post p
        JOIN member m ON p.author_id = m.member_id
        JOIN board_category c ON p.category_id = c.category_id
        WHERE p.is_deleted = 'N'
        AND p.category_id = #{categoryId}
        ORDER BY p.created_at DESC
    ) WHERE ROWNUM <![CDATA[<=]]> 5
</select>

</mapper>