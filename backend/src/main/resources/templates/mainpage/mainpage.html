<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ì»¤ë®¤ë‹ˆí‹° ë©”ì¸</title>
    <link rel="stylesheet" href="/communityCss/mainPage.css" />

    <!-- ì‚¬ê³¼ê²Œì„ ì ìˆ˜ìš© í°íŠ¸ -->
    <link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet" />

  </head>

  <body>
    <th:block th:include="common/header"></th:block>
	<!-- ì‚¬ì´ë“œ ê´‘ê³  ì˜ì—­ (ì¢Œìš°) -->
    <div class="mainpage-side-ads">
        <div class="mainpage-side-ad mainpage-side-ad-left">
            <p>ê´‘ê³  ì˜ì—­</p>
        </div>
        <div class="mainpage-side-ad mainpage-side-ad-right">
            <p>ê´‘ê³  ì˜ì—­</p>
        </div>
    </div>
		   <!-- ë©”ì¸ ë°°ë„ˆ ì˜ì—­ (ë¡œê·¸ì¸ ì•ˆ í•œ ê²½ìš°ë§Œ í‘œì‹œ) -->
		<section class="mainpage-banner" th:if="${!isLoggedIn}">
		  <div class="mainpage-banner-content">
		    <div class="mainpage-banner-tag">COMMUNITY</div>
		    <h1>í•¨ê»˜ ì†Œí†µí•˜ê³  ì„±ì¥í•˜ëŠ”<br>ì»¤ë®¤ë‹ˆí‹°</h1>
		    <p>ë‹¤ì–‘í•œ ì£¼ì œë¡œ ëŒ€í™”í•˜ê³ , ì§€ì‹ì„ ê³µìœ í•˜ë©°, ìƒˆë¡œìš´ ì¹œêµ¬ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”</p>
		    <div class="mainpage-banner-buttons">
		      <button class="mainpage-btn-primary" onclick="location.href='/app/login'">
		        ë¡œê·¸ì¸
		        <span class="mainpage-btn-arrow">â†’</span>
		      </button>
		      <button class="mainpage-btn-secondary" onclick="location.href='/app/signup'">
		        ì²˜ìŒì´ì‹ ê°€ìš”?
		      </button>
		    </div>
		  </div>
		  <div class="mainpage-banner-decoration">
		    <div class="mainpage-banner-circle mainpage-circle-1"></div>
		    <div class="mainpage-banner-circle mainpage-circle-2"></div>
		    <div class="mainpage-banner-circle mainpage-circle-3"></div>
		  </div>
		</section>
		
		<!-- ì»¤ë®¤ë‹ˆí‹° íŠ¹ì§• ì†Œê°œ (ë¡œê·¸ì¸ ì•ˆ í•œ ê²½ìš°ë§Œ í‘œì‹œ) -->
		<section class="mainpage-features" th:if="${!isLoggedIn}">
		  <div class="mainpage-features-tag">FEATURES</div>
		  <h2>ì»¤ë®¤ë‹ˆí‹°ì˜ íŠ¹ì§•</h2>
		  <div class="mainpage-feature-list">
		    <div class="mainpage-feature-item">
		      <div class="mainpage-feature-icon-wrapper">
		        <div class="mainpage-feature-icon">ğŸ’¬</div>
		      </div>
		      <h3>ììœ ë¡œìš´ ì†Œí†µ</h3>
		      <p>ë‹¤ì–‘í•œ ì£¼ì œë¡œ ììœ ë¡­ê²Œ ëŒ€í™”í•˜ê³  ì˜ê²¬ì„ ë‚˜ëˆ ë³´ì„¸ìš”</p>
		    </div>
		    <div class="mainpage-feature-item">
		      <div class="mainpage-feature-icon-wrapper">
		        <div class="mainpage-feature-icon">ğŸ‘¥</div>
		      </div>
		      <h3>í™œë°œí•œ ì»¤ë®¤ë‹ˆí‹°</h3>
		      <p>í™œë°œí•˜ê²Œ ì§ˆë¬¸ê³¼ ë‹µë³€ ë“±ì„ ì˜¬ë¦¬ëŠ” ì»¤ë®¤ë‹ˆí‹°</p>
		    </div>
		    <div class="mainpage-feature-item">
		      <div class="mainpage-feature-icon-wrapper">
		        <div class="mainpage-feature-icon">ğŸ“ˆ</div>
		      </div>
		      <h3>íŠ¸ë Œë”© ì½˜í…ì¸ </h3>
		      <p>ì¸ê¸° ìˆëŠ” ê²Œì‹œê¸€ê³¼ í•«í•œ í† í”½ì„ ë§Œë“¤ì–´ìš”</p>
		    </div>
		  </div>
		</section>

    <!-- ê³µì§€ì‚¬í•­ ì˜ì—­ (ë¡œê·¸ì¸ í•œ ê²½ìš° ë§¨ ìœ„, ì•ˆ í•œ ê²½ìš° ì¸ê¸°ê²Œì‹œê¸€ ì•„ë˜) -->
    <section class="mainpage-notices" th:classappend="${isLoggedIn} ? 'mainpage-logged-in' : ''">
      <div class="mainpage-notices-header">
        <h2>ê³µì§€ì‚¬í•­</h2>
        <a href="javascript:void(0);" class="mainpage-more-link" onclick="toggleNotices()">ë”ë³´ê¸° â†“</a>
      </div>

      <div class="mainpage-notice-list" id="noticeList">
        <div class="mainpage-notice-item"
		     th:each="notice, stat : ${noticeList}"
		     th:classappend="${stat.index >= 5} ? 'mainpage-notice-hidden' : ''"
		     th:onclick="|location.href='/notice/' + ${notice.noticeId}|"
		     style="cursor: pointer;">
		  <span class="mainpage-notice-badge" th:text="${notice.noticeType}">ê³µì§€</span>
		  <span class="mainpage-notice-title" th:text="${notice.title}">ì œëª©</span>
		  <span class="mainpage-notice-date"
      th:text="${#dates.format(notice.createdAt, 'yyyy. MM. dd.')}">ë‚ ì§œ</span>
		</div>
      </div>
    </section>

    <!-- ì¸ê¸° ê²Œì‹œê¸€ ì˜ì—­ (ë¡œê·¸ì¸ ì—¬ë¶€ ìƒê´€ì—†ì´ í‘œì‹œ) -->
    <section class="mainpage-posts">
      <div class="mainpage-posts-header">
        <h2>ì¸ê¸° ê²Œì‹œê¸€</h2>
        <a href="javascript:void(0);" class="mainpage-more-link" onclick="togglePosts()">ë”ë³´ê¸° â†“</a>
      </div>

      <div class="mainpage-top-container">
        <div class="mainpage-top-section">
          <h3 class="mainpage-section-title">ğŸ‘ ì¡°íšŒìˆ˜ TOP</h3>
          <div class="mainpage-top-list">
            <div class="mainpage-top-item"
                 th:each="post, stat : ${viewTopPosts}"
                 th:onclick="|location.href='/board/postDetail/' + ${post.postId}|"
                 style="cursor: pointer;">
              <span class="mainpage-rank" th:text="${stat.index + 1}">1</span>
              <div class="mainpage-item-content">
                <span class="mainpage-post-tag" th:text="${post.categoryName}">ììœ </span>
                <h4 th:text="${post.title}">ì œëª©</h4>
                <div class="mainpage-post-info">
                  <span th:text="${post.nickname}">ì‘ì„±ì</span>
                  <span th:text="'ğŸ‘ ' + ${post.viewCount}">ì¡°íšŒìˆ˜</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="mainpage-top-section">
          <h3 class="mainpage-section-title">â¤ ì¢‹ì•„ìš” TOP</h3>
          <div class="mainpage-top-list">
            <div class="mainpage-top-item"
                 th:each="post, stat : ${likeTopPosts}"
                 th:onclick="|location.href='/board/postDetail/' + ${post.postId}|"
                 style="cursor: pointer;">
              <span class="mainpage-rank" th:text="${stat.index + 1}">1</span>
              <div class="mainpage-item-content">
                <span class="mainpage-post-tag" th:text="${post.categoryName}">ììœ </span>
                <h4 th:text="${post.title}">ì œëª©</h4>
                <div class="mainpage-post-info">
                  <span th:text="${post.nickname}">ì‘ì„±ì</span>
                  <span th:text="'â¤ ' + ${post.likeCount}">ì¢‹ì•„ìš”</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="mainpage-top-section">
          <h3 class="mainpage-section-title">ğŸ’¬ ëŒ“ê¸€ TOP</h3>
          <div class="mainpage-top-list">
            <div class="mainpage-top-item"
                 th:each="post, stat : ${commentTopPosts}"
                 th:onclick="|location.href='/board/postDetail/' + ${post.postId}|"
                 style="cursor: pointer;">
              <span class="mainpage-rank" th:text="${stat.index + 1}">1</span>
              <div class="mainpage-item-content">
                <span class="mainpage-post-tag" th:text="${post.categoryName}">ììœ </span>
                <h4 th:text="${post.title}">ì œëª©</h4>
                <div class="mainpage-post-info">
                  <span th:text="${post.nickname}">ì‘ì„±ì</span>
                  <span th:text="'ğŸ’¬ ' + ${post.commentCount}">ëŒ“ê¸€</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

   <!-- ë¡œê·¸ì¸ í•œ ê²½ìš°: ì¹´í…Œê³ ë¦¬ë³„ ê²Œì‹œíŒ -->
<section class="mainpage-category-boards" th:if="${isLoggedIn}">
  <div class="mainpage-boards-header">
    <h2>ì¹´í…Œê³ ë¦¬ë³„ ê²Œì‹œíŒ</h2>
  </div>

  <div class="mainpage-boards-container">
    <div class="mainpage-board-card" th:each="category : ${categories}">
      <h3 class="mainpage-board-card-title" th:text="${category.categoryName}">ì¹´í…Œê³ ë¦¬</h3>
      <div class="mainpage-board-card-list">
        <div class="mainpage-board-card-item"
             th:each="post : ${categoryPosts.get(category.categoryName)}"
             th:onclick="|location.href='/board/postDetail/' + ${post.postId}|"
             style="cursor: pointer;">
          <div class="mainpage-board-card-content">
            <p class="mainpage-board-card-post-title" th:text="${post.title}">ì œëª©</p>
            <div class="mainpage-board-card-info">
			  <span th:text="${post.nickname}">ì‘ì„±ì</span>
			  <span th:text="${#dates.format(post.createdAt, 'MM.dd')}">ë‚ ì§œ</span>
			</div>
          </div>
        </div>
        
        <div th:if="${#lists.isEmpty(categoryPosts.get(category.categoryName))}" 
             class="mainpage-board-card-empty">
          ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
        </div>
      </div>
    </div>
  </div>
</section>

    <!-- ì‚¬ê³¼ê²Œì„ ì„¹ì…˜ -->
    <section class="applegame" id="appleTop">
      <h1>ğŸ ì‚¬ê³¼ê²Œì„</h1>

      <div class="applegame-controls">
        <button id="startBtn" type="button">ê²Œì„ ì‹œì‘</button>
        <div id="score">Score : 0</div>
        <div id="timerContainer" aria-label="ë‚¨ì€ ì‹œê°„">
          <div id="timerBar">
            <div id="timerBarFill"></div>
          </div>
        </div>
      </div>

      <div class="applegame-board">
        <div class="applegame-board-inner">
          <div id="gameOverlay" class="applegame-overlay" aria-live="polite">
            <div class="applegame-overlay-card">
              <div class="applegame-overlay-badge">10 ë§Œë“¤ê¸° í¼ì¦</div>
              <h2 class="applegame-overlay-title">ë“œë˜ê·¸ë¡œ ì‚¬ê³¼ë¥¼ ì„ íƒí•´ì„œ í•©ì´ 10ì´ë©´ ì œê±°!</h2>
              <p class="applegame-overlay-desc">
                ìˆ«ìê°€ ì íŒ ì‚¬ê³¼ë“¤ì„ <b>ë“œë˜ê·¸</b>ë¡œ ì˜ì—­ ì„ íƒí•˜ì„¸ìš”.<br />
                ì„ íƒí•œ ì‚¬ê³¼ ìˆ«ìì˜ <b>í•©ì´ 10</b>ì´ë©´ ì‚¬ê³¼ê°€ ì‚¬ë¼ì§€ê³  ì ìˆ˜ë¥¼ ì–»ìŠµë‹ˆë‹¤.
              </p>

              <div class="applegame-rulegrid">
                <div class="applegame-rule">
                  <div class="applegame-rule-k">ì¡°ì‘</div>
                  <div class="applegame-rule-v">ë§ˆìš°ìŠ¤ ë“œë˜ê·¸(ì¢Œí´ë¦­)ë¡œ ì˜ì—­ ì„ íƒ</div>
                </div>
                <div class="applegame-rule">
                  <div class="applegame-rule-k">ì ìˆ˜</div>
                  <div class="applegame-rule-v">ì œê±°í•œ ê°œìˆ˜ì˜ <b>ì œê³±</b> (ì˜ˆ: 3ê°œ â†’ 9ì )</div>
                </div>
                <div class="applegame-rule">
                  <div class="applegame-rule-k">ì‹œê°„</div>
                  <div class="applegame-rule-v"><b>120ì´ˆ</b> ì œí•œ</div>
                </div>
                <div class="applegame-rule">
                  <div class="applegame-rule-k">ë³´ë„ˆìŠ¤</div>
                  <div class="applegame-rule-v">ğŸ+3 ì‚¬ê³¼ í´ë¦­ ì‹œ <b>3ì </b> íšë“</div>
                </div>
              </div>

              <div class="applegame-overlay-actions">
                <button id="overlayStartBtn" type="button" class="applegame-overlay-primary">ê²Œì„ ì‹œì‘</button>
                <button id="overlayHowBtn" type="button" class="applegame-overlay-ghost">í•œ ë²ˆ ë” ì„¤ëª…</button>
              </div>

              <div class="applegame-overlay-foot">
                íŒ: ë§ì€ ê°œìˆ˜ë¥¼ í•œ ë²ˆì— ë§ì¶”ë©´ ì ìˆ˜ê°€ í¬ê²Œ ì˜¬ë¼ê°€ìš”.
              </div>
            </div>
          </div>

         <div id="game" aria-label="ê²Œì„ ë³´ë“œ">
		      <div id="scoreLogs"></div>
		    </div>
		
		    <div id="selectionBox"></div> <!-- ì—¬ê¸°ë¡œ ë‹¤ì‹œ ì´ë™ -->
        </div>
      </div>
    </section>

    <!-- í•˜ë‹¨ ë°°ë„ˆ (ë¡œê·¸ì¸ ì•ˆ í•œ ê²½ìš°ë§Œ í‘œì‹œ) -->
    <section class="mainpage-bottom-banner" th:if="${!isLoggedIn}">
      <div class="mainpage-bottom-content">
        <h2>ì§€ê¸ˆ ë°”ë¡œ ì»¤ë®¤ë‹ˆí‹°ì— ì°¸ì—¬í•˜ì„¸ìš”</h2>
        <p>ë¬´ë£Œë¡œ ê°€ì…í•˜ê³  ë‹¤ì–‘í•œ ì‚¬ëŒë“¤ê³¼ ì†Œí†µí•´ë³´ì„¸ìš”</p>
        <button class="mainpage-btn-join" onclick="location.href='/app/signup'">íšŒì›ê°€ì…</button>
      </div>
    </section>

    <th:block th:include="common/footer"></th:block>

    <script th:inline="javascript">
      /* =========================
         ì¹´í…Œê³ ë¦¬ ë°ì´í„° (Thymeleafì—ì„œ ì „ë‹¬)
      ========================= */
      const categoryPostsData = /*[[${categoryPosts}]]*/ {};

      /* =========================
         ì¹´í…Œê³ ë¦¬ í† ê¸€ í•¨ìˆ˜
      ========================= */
      function toggleCategory(button) {
        const categoryName = button.dataset.categoryName;
        const categoryContent = document.getElementById('categoryContent');
        const categoryTitle = document.getElementById('categoryTitle');
        const categoryPostsDiv = document.getElementById('categoryPosts');

        // ê°™ì€ ë²„íŠ¼ ë‹¤ì‹œ í´ë¦­í•˜ë©´ ë‹«ê¸°
        if (categoryContent.style.display === 'block' && categoryTitle.textContent === categoryName) {
          categoryContent.style.display = 'none';
          button.classList.remove('active');
          return;
        }

        // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
        document.querySelectorAll('.mainpage-category-btn').forEach(btn => {
          btn.classList.remove('active');
        });

        // í˜„ì¬ ë²„íŠ¼ í™œì„±í™”
        button.classList.add('active');

        // ì¹´í…Œê³ ë¦¬ ì œëª© ì„¤ì •
        categoryTitle.textContent = categoryName;

        // ê²Œì‹œê¸€ ëª©ë¡ í‘œì‹œ
        const posts = categoryPostsData[categoryName] || [];
        categoryPostsDiv.innerHTML = '';

        if (posts.length === 0) {
          categoryPostsDiv.innerHTML = '<p style="text-align: center; color: #999;">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        } else {
          posts.forEach(post => {
            const postItem = document.createElement('div');
            postItem.className = 'mainpage-board-item';
            postItem.style.cursor = 'pointer';
            postItem.onclick = function() {
              location.href = '/board/postDetail/' + post.postId;
            };

            postItem.innerHTML = `
              <div class="mainpage-board-content">
                <h4>${post.title}</h4>
                <div class="mainpage-board-info">
                  <span>${post.nickname}</span>
                  <span>ğŸ‘ ${post.viewCount}</span>
                  <span>â¤ ${post.likeCount}</span>
                  <span>ğŸ’¬ ${post.commentCount}</span>
                </div>
              </div>
            `;

            categoryPostsDiv.appendChild(postItem);
          });
        }

        // ì½˜í…ì¸  í‘œì‹œ
        categoryContent.style.display = 'block';
      }

      /* =========================
         ë©”ì¸ í˜ì´ì§€ í† ê¸€
      ========================= */
      function togglePosts() {
        const sections = document.querySelectorAll('.mainpage-top-section');
        const moreLink = document.querySelector('.mainpage-posts .mainpage-more-link');

        sections.forEach(section => {
          const items = section.querySelectorAll('.mainpage-top-item');

          if (items[1] && (items[1].style.display === 'none' || items[1].style.display === '')) {
            items.forEach(item => item.style.display = 'flex');
            moreLink.textContent = 'ì ‘ê¸° â†‘';
          } else {
            items.forEach((item, index) => {
              if (index >= 1) item.style.display = 'none';
            });
            moreLink.textContent = 'ë”ë³´ê¸° â†“';
          }
        });
      }

      function toggleNotices() {
        const hiddenNotices = document.querySelectorAll('.mainpage-notice-hidden');
        const moreLink = document.querySelector('.mainpage-notices .mainpage-more-link');

        if (!hiddenNotices.length) return;

        if (hiddenNotices[0].style.display === 'none' || hiddenNotices[0].style.display === '') {
          hiddenNotices.forEach((notice) => notice.style.display = 'flex');
          moreLink.textContent = 'ì ‘ê¸° â†‘';
        } else {
          hiddenNotices.forEach((notice) => notice.style.display = 'none');
          moreLink.textContent = 'ë”ë³´ê¸° â†“';
        }
      }

      /* =========================
         ì‚¬ê³¼ê²Œì„ ë¡œì§
      ========================= */
      (function(){
        const game = document.getElementById('game');
        const scoreDisplay = document.getElementById('score');
        const timerBarFill = document.getElementById('timerBarFill');
        const startBtn = document.getElementById('startBtn');

        const overlay = document.getElementById('gameOverlay');
        const overlayStartBtn = document.getElementById('overlayStartBtn');
        const overlayHowBtn = document.getElementById('overlayHowBtn');

        const selectionBox = document.getElementById('selectionBox');
        const scoreLogs = document.getElementById('scoreLogs');

        const COLS = 17;
        const ROWS = 10;

        let score = 0;
        let timeLeft = 120;
        let timer;

        let startX = 0, startY = 0;
        let isDragging = false;

        let applesGrid = [];
        let currentSelected = [];
        let isGameRunning = false;

        const boardInner = document.querySelector('.applegame-board-inner');
        const timeAppleContainer = document.createElement('div');
        timeAppleContainer.style.position = 'absolute';
        timeAppleContainer.style.inset = '0';
        timeAppleContainer.style.pointerEvents = 'none';
        timeAppleContainer.style.zIndex = '4500';
        boardInner.appendChild(timeAppleContainer);

        function showOverlay(mode, finalScore){
          overlay.style.display = 'grid';

          const title = overlay.querySelector('.applegame-overlay-title');
          const desc = overlay.querySelector('.applegame-overlay-desc');
          const badge = overlay.querySelector('.applegame-overlay-badge');
          const foot = overlay.querySelector('.applegame-overlay-foot');

          if(mode === 'end'){
            badge.textContent = 'ê²Œì„ ì¢…ë£Œ';
            title.textContent = `ìµœì¢… ì ìˆ˜: ${finalScore}ì `;
            desc.innerHTML = `ë‹¤ì‹œ í•œ ë²ˆ ë„ì „í•´ë³¼ê¹Œìš”?<br/>ë” í¬ê²Œ ë¬¶ì„ìˆ˜ë¡ ì ìˆ˜ê°€ ì œê³±ìœ¼ë¡œ ì˜¬ë¼ê°€ìš”!`;
            foot.textContent = 'íŒ: 4ê°œ(16ì ), 5ê°œ(25ì )ì²˜ëŸ¼ í¬ê²Œ ë§ì¶”ë©´ ì ìˆ˜ í­ë°œ';
            overlayStartBtn.textContent = 'ë‹¤ì‹œ í•˜ê¸°';
          }else{
            badge.textContent = '10 ë§Œë“¤ê¸° í¼ì¦';
            title.textContent = 'ë“œë˜ê·¸ë¡œ ì‚¬ê³¼ë¥¼ ì„ íƒí•´ì„œ í•©ì´ 10ì´ë©´ ì œê±°!';
            desc.innerHTML = `ìˆ«ìê°€ ì íŒ ì‚¬ê³¼ë“¤ì„ <b>ë“œë˜ê·¸</b>ë¡œ ì˜ì—­ ì„ íƒí•˜ì„¸ìš”.<br/>ì„ íƒí•œ ì‚¬ê³¼ ìˆ«ìì˜ <b>í•©ì´ 10</b>ì´ë©´ ì‚¬ê³¼ê°€ ì‚¬ë¼ì§€ê³  ì ìˆ˜ë¥¼ ì–»ìŠµë‹ˆë‹¤.`;
            foot.textContent = 'íŒ: ë§ì€ ê°œìˆ˜ë¥¼ í•œ ë²ˆì— ë§ì¶”ë©´ ì ìˆ˜ê°€ í¬ê²Œ ì˜¬ë¼ê°€ìš”.';
            overlayStartBtn.textContent = 'ê²Œì„ ì‹œì‘';
          }
        }

        function hideOverlay(){
          overlay.style.display = 'none';
        }

        function generateApple(value) {
          const apple = document.createElement('div');
          apple.className = 'apple';
          apple.dataset.value = value;

          const span = document.createElement('span');
          span.textContent = value;
          apple.appendChild(span);

          return apple;
        }
        
        function renderGrid() {
        	  const keepLogs = scoreLogs;
        	  game.innerHTML = '';

        	  for (let r = 0; r < ROWS; r++) {
        	    for (let c = 0; c < COLS; c++) {
        	      const apple = applesGrid[r][c];
        	      if (apple) {
        	        game.appendChild(apple);
        	      } else {
        	        const empty = document.createElement('div');
        	        empty.style.width = '30px';
        	        empty.style.height = '30px';
        	        game.appendChild(empty);
        	      }
        	    }
        	  }

        	  if (!game.contains(keepLogs)) game.appendChild(keepLogs);
        	}


        function addScoreLog(points) {
        	  if(points <= 0) return;

        	  // ì´ì „ ë¡œê·¸ ì „ë¶€ ì‚­ì œ
        	  scoreLogs.innerHTML = '';

        	  const logItem = document.createElement('div');
        	  logItem.className = 'scoreLogItem';
        	  if (points >= 6) logItem.classList.add('blue');

        	  logItem.innerHTML =
        	    `<span class="scoreLogPoints">+${points}</span>` +
        	    `<span class="scoreLogApple">ğŸ</span>`;

        	  scoreLogs.appendChild(logItem);
        	}

        function updateScore() {
          scoreDisplay.textContent = 'Score : ' + score;
        }

        function updateTimerBar() {
          const percent = Math.max(0, (timeLeft / 120) * 100);
          timerBarFill.style.width = percent + '%';
        }

        function clearSelectedBorders() {
          currentSelected.forEach(({apple}) => apple.classList.remove('selected'));
          currentSelected = [];
        }

        function updateSelectedApples(boxLeft, boxTop, boxRight, boxBottom) {
          clearSelectedBorders();
          let newlySelected = [];

          for (let r = 0; r < ROWS; r++) {
            for (let c = 0; c < COLS; c++) {
              const apple = applesGrid[r][c];
              if (!apple) continue;

              const rect = apple.getBoundingClientRect();
              const isOverlap = !(rect.right < boxLeft || rect.left > boxRight || rect.bottom < boxTop || rect.top > boxBottom);

              if (isOverlap) {
                apple.classList.add('selected');
                newlySelected.push({ r, c, apple });
              }
            }
          }

          currentSelected = newlySelected;
        }

        function startGame() {
        	  hideOverlay();

        	  timeAppleContainer.innerHTML = '';

        	  applesGrid = [];
        	  score = 0;
        	  timeLeft = 120;
        	  updateScore();
        	  updateTimerBar();
        	  scoreLogs.innerHTML = '';
        	  currentSelected = [];
        	  isGameRunning = true;

        	  for (let r = 0; r < ROWS; r++) {
        	    applesGrid[r] = [];
        	    for (let c = 0; c < COLS; c++) {
        	      const rand = Math.floor(Math.random() * 9) + 1;
        	      applesGrid[r][c] = generateApple(rand);
        	    }
        	  }

        	  renderGrid();

        	  clearInterval(timer);
        	  timer = setInterval(() => {
        	    timeLeft--;
        	    updateTimerBar();
        	    if (timeLeft <= 0) {
        	      clearInterval(timer);
        	      isGameRunning = false;
        	      showOverlay("end", score);
        	    }
        	  }, 1000);

        	  // ì‹œê°„ ì‚¬ê³¼ ì¸í„°ë²Œ ì œê±°
        	  if (window.timeAppleInterval) clearInterval(window.timeAppleInterval);
        	}

        function createTimeApple() {
          if (!isGameRunning) return;
          if (timeAppleContainer.childElementCount >= 3) return;

          const apple = document.createElement('div');
          apple.textContent = 'ğŸ +3';
          apple.style.position = 'absolute';
          apple.style.fontSize = '46px';
          apple.style.cursor = 'pointer';
          apple.style.userSelect = 'none';
          apple.style.color = '#d35400';
          apple.style.fontWeight = '900';
          apple.style.filter = 'drop-shadow(0 0 1px rgba(0,0,0,0.3))';
          apple.style.pointerEvents = 'auto';
          apple.style.zIndex = '4600';

          const side = Math.random() < 0.5 ? 'left' : 'right';
          const fromTop = Math.random() < 0.5;

          if (side === 'left') apple.style.left = '10px';
          else apple.style.right = '10px';

          if (fromTop) {
        	  apple.style.top = '10px';
        	  apple.style.animation = `timeAppleDown 1s linear forwards`;
        	} else {
        	  apple.style.bottom = '10px';
        	  apple.style.animation = `timeAppleUp 1s linear forwards`;
        	}

          apple.addEventListener('animationend', () => {
            if (apple.parentNode) timeAppleContainer.removeChild(apple);
          });

          apple.addEventListener('click', (e) => {
        	  if (!isGameRunning) return;
        	  if (apple.dataset.clicked) return;
        	  
        	  e.stopPropagation();
        	  apple.dataset.clicked = 'true';
        	  
        	  score += 3;
        	  updateScore();
        	  addScoreLog(3);

        	  apple.style.animation = '';
        	  apple.style.pointerEvents = 'none';
        	  apple.classList.add('growFade');

        	  setTimeout(() => {
        	    if (apple.parentNode) timeAppleContainer.removeChild(apple);
        	  }, 600);
        	});

          timeAppleContainer.appendChild(apple);
        }

        game.addEventListener('mousedown', (e) => {
        	  if (!isGameRunning) return;
        	  if (e.button !== 0) return;

        	  isDragging = true;
        	  startX = e.clientX;
        	  startY = e.clientY;

        	  selectionBox.style.left = startX + 'px';
        	  selectionBox.style.top = startY + 'px';
        	  selectionBox.style.width = '0px';
        	  selectionBox.style.height = '0px';
        	  selectionBox.style.display = 'block';
        	});

        	window.addEventListener('mousemove', (e) => {
        	  if (!isDragging) return;

        	  const currentX = e.clientX;
        	  const currentY = e.clientY;

        	  const x = Math.min(startX, currentX);
        	  const y = Math.min(startY, currentY);
        	  const width = Math.abs(startX - currentX);
        	  const height = Math.abs(startY - currentY);

        	  selectionBox.style.left = x + 'px';
        	  selectionBox.style.top = y + 'px';
        	  selectionBox.style.width = width + 'px';
        	  selectionBox.style.height = height + 'px';

        	  updateSelectedApples(x, y, x + width, y + height);
        	});

        window.addEventListener('mouseup', () => {
        	  if (!isGameRunning) return;
        	  if (!isDragging) return;

        	  isDragging = false;
        	  selectionBox.style.display = 'none';

        	  const selected = currentSelected;
        	  const sum = selected.reduce((acc, obj) => acc + parseInt(obj.apple.dataset.value), 0);

        	  if (sum === 10 && selected.length > 0) {
        	    const points = selected.length ** 2;
        	    score += points;
        	    updateScore();
        	    addScoreLog(points);

        	    // ì‹œê°„ 5ì´ˆ ì¶”ê°€
        	    timeLeft += 5;
        	    updateTimerBar();

        	    // ì‹œê°„ ì‚¬ê³¼ ìƒì„±
        	    createTimeApple();

        	    selected.forEach(({ r, c, apple }) => {
        	      apple.classList.add('vanish');
        	      apple.addEventListener('animationend', () => {
        	        applesGrid[r][c] = null;
        	        renderGrid();
        	      }, { once: true });
        	    });
        	  }

        	  clearSelectedBorders();
        	});

        startBtn.addEventListener('click', () => startGame());
        overlayStartBtn.addEventListener('click', () => startGame());
        overlayHowBtn.addEventListener('click', () => showOverlay("intro", 0));

        showOverlay("intro", 0);
        updateTimerBar();
        updateScore();
      })();

      window.onload = function () {
    	  const sections = document.querySelectorAll('.mainpage-top-section');
    	  sections.forEach(section => {
    	    const items = section.querySelectorAll('.mainpage-top-item');
    	    items.forEach((item, index) => {
    	      if (index >= 1) item.style.display = 'none';
    	    });
    	  });

    	  const hiddenNotices = document.querySelectorAll('.mainpage-notice-hidden');
    	  hiddenNotices.forEach((notice) => {
    	    notice.style.display = 'none';
    	  });
    	};
    </script>
  </body>
</html>