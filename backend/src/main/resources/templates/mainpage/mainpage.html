<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>커뮤니티 메인</title>
    <link rel="stylesheet" href="/communityCss/mainPage.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <th:block th:include="common/header"></th:block>

    <!-- 사이드 광고 영역 (좌우) -->
    <div class="mainpage-side-ads">
      <div class="mainpage-side-ad mainpage-side-ad-left">
        <p>광고 영역</p>
      </div>
      <div class="mainpage-side-ad mainpage-side-ad-right">
        <p>광고 영역</p>
      </div>
    </div>

    <!-- 메인 배너 영역 (로그인 안 한 경우만 표시) -->
    <section class="mainpage-banner" th:if="${!isLoggedIn}">
      <div class="mainpage-banner-content">
        <div class="mainpage-banner-tag">COMMUNITY</div>
        <h1>함께 소통하고 성장하는<br />커뮤니티</h1>
        <p>다양한 주제로 대화하고, 지식을 공유하며, 새로운 친구를 만나보세요</p>
        <div class="mainpage-banner-buttons">
          <button class="mainpage-btn-primary" onclick="location.href='/app/login'">
            로그인
            <span class="mainpage-btn-arrow">→</span>
          </button>
          <button class="mainpage-btn-secondary" onclick="location.href='/app/signup'">
            처음이신가요?
          </button>
        </div>
      </div>
      <div class="mainpage-banner-decoration">
        <div class="mainpage-banner-circle mainpage-circle-1"></div>
        <div class="mainpage-banner-circle mainpage-circle-2"></div>
        <div class="mainpage-banner-circle mainpage-circle-3"></div>
      </div>
    </section>

    <!-- 인기 게시글 영역 (로그인 여부 상관없이 표시) -->
    <section class="mainpage-posts">
      <div class="mainpage-posts-header">
        <h2>인기 게시글</h2>
        <a href="javascript:void(0);" class="mainpage-more-link" onclick="togglePosts()">더보기 ↓</a>
      </div>

      <div class="mainpage-top-container">
        <div class="mainpage-top-section">
          <h3 class="mainpage-section-title">👁 조회수 TOP</h3>
          <div class="mainpage-top-list">
            <div
              class="mainpage-top-item"
              th:each="post, stat : ${viewTopPosts}"
              th:onclick="|location.href='/board/postDetail/' + ${post.postId}|"
              style="cursor: pointer;"
            >
              <span class="mainpage-rank" th:text="${stat.index + 1}">1</span>
              <div class="mainpage-item-content">
                <span class="mainpage-post-tag" th:text="${post.categoryName}">자유</span>
                <h4 th:text="${post.title}">제목</h4>
                <div class="mainpage-post-info">
				  <span th:text="${post.nickname}">작성자</span>
				  <span th:text="'👁 ' + ${post.viewCount}">조회수</span>
				  <span class="new-badge" th:if="${#dates.format(post.createdAt, 'yyyy-MM-dd') eq #dates.format(today, 'yyyy-MM-dd')}">NEW</span>
				</div>
              </div>
            </div>
          </div>
        </div>

        <div class="mainpage-top-section">
          <h3 class="mainpage-section-title">❤ 좋아요 TOP</h3>
          <div class="mainpage-top-list">
            <div
              class="mainpage-top-item"
              th:each="post, stat : ${likeTopPosts}"
              th:onclick="|location.href='/board/postDetail/' + ${post.postId}|"
              style="cursor: pointer;"
            >
              <span class="mainpage-rank" th:text="${stat.index + 1}">1</span>
              <div class="mainpage-item-content">
                <span class="mainpage-post-tag" th:text="${post.categoryName}">자유</span>
                <h4 th:text="${post.title}">제목</h4>
                <div class="mainpage-post-info">
				  <span th:text="${post.nickname}">작성자</span>
				  <span th:text="'❤ ' + ${post.likeCount}">좋아요</span>
				  <span class="new-badge" th:if="${#dates.format(post.createdAt, 'yyyy-MM-dd') eq #dates.format(today, 'yyyy-MM-dd')}">NEW</span>
				</div>
              </div>
            </div>
          </div>
        </div>

        <div class="mainpage-top-section">
          <h3 class="mainpage-section-title">💬 댓글 TOP</h3>
          <div class="mainpage-top-list">
            <div
              class="mainpage-top-item"
              th:each="post, stat : ${commentTopPosts}"
              th:onclick="|location.href='/board/postDetail/' + ${post.postId}|"
              style="cursor: pointer;"
            >
              <span class="mainpage-rank" th:text="${stat.index + 1}">1</span>
              <div class="mainpage-item-content">
                <span class="mainpage-post-tag" th:text="${post.categoryName}">자유</span>
                <h4 th:text="${post.title}">제목</h4>
                <div class="mainpage-post-info">
				  <span th:text="${post.nickname}">작성자</span>
				  <span th:text="'💬 ' + ${post.commentCount}">댓글</span>
				  <span class="new-badge" th:if="${#dates.format(post.createdAt, 'yyyy-MM-dd') eq #dates.format(today, 'yyyy-MM-dd')}">NEW</span>
				  
				</div>				
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 카테고리별 게시판 (로그인 여부 상관없이 표시) -->
    <section class="mainpage-category-boards">
      <div class="mainpage-boards-header">
        <h2>카테고리별 게시판</h2>
      </div>

      <div class="mainpage-boards-container">
        <div class="mainpage-board-card" th:each="category : ${categories}">
          <h3 class="mainpage-board-card-title" th:text="${category.categoryName}">카테고리</h3>
          <div class="mainpage-board-card-list">
            <div
              class="mainpage-board-card-item"
              th:each="post : ${categoryPosts.get(category.categoryName)}"
              th:onclick="|location.href='/board/postDetail/' + ${post.postId}|"
              style="cursor: pointer;"
            >
              <div class="mainpage-board-card-content">
                <p class="mainpage-board-card-post-title" th:text="${post.title}">제목</p>
                <div class="mainpage-board-card-info">
				  <span th:text="${post.nickname}">작성자</span>
				  <div class="mainpage-board-card-right">
				    <span th:text="${#dates.format(post.createdAt, 'MM.dd')}">날짜</span>
				    <span class="new-badge" th:if="${#dates.format(post.createdAt, 'yyyy-MM-dd') eq #dates.format(today, 'yyyy-MM-dd')}">NEW</span>
				  </div>
				</div>
              </div>
            </div>

            <div th:if="${#lists.isEmpty(categoryPosts.get(category.categoryName))}" class="mainpage-board-card-empty">
              게시글이 없습니다.
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 하단 배너 (로그인 안 한 경우만 표시) -->
    <section class="mainpage-bottom-banner" th:if="${!isLoggedIn}">
      <div class="mainpage-bottom-content">
        <h2>지금 바로 커뮤니티에 참여하세요</h2>
        <p>무료로 가입하고 다양한 사람들과 소통해보세요</p>
        <button class="mainpage-btn-join" onclick="location.href='/app/signup'">회원가입</button>
      </div>
    </section>

    <th:block th:include="common/footer"></th:block>

    <script th:inline="javascript">
      // 카테고리별 색상 매핑
      const categoryColors = {
        '자유': { bg: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', shadow: 'rgba(102, 126, 234, 0.25)', text: '#667eea' },
        '유머': { bg: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', shadow: 'rgba(240, 147, 251, 0.25)', text: '#f5576c' },
        '정보': { bg: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', shadow: 'rgba(79, 172, 254, 0.25)', text: '#4facfe' },
        '질문': { bg: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', shadow: 'rgba(250, 112, 154, 0.25)', text: '#fa709a' },
        '여행': { bg: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', shadow: 'rgba(240, 147, 251, 0.25)', text: '#f5576c' },
        '기타': { bg: 'linear-gradient(135deg, #30cfd0 0%, #330867 100%)', shadow: 'rgba(48, 207, 208, 0.25)', text: '#30cfd0' },
        '개발': { bg: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)', shadow: 'rgba(168, 237, 234, 0.25)', text: '#a8edea' },
        '일상': { bg: 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)', shadow: 'rgba(252, 182, 159, 0.25)', text: '#fcb69f' },
        '경제': { bg: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', shadow: 'rgba(240, 147, 251, 0.25)', text: '#f5576c' },
        '취미': { bg: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', shadow: 'rgba(79, 172, 254, 0.25)', text: '#4facfe' }
      };

      // 페이지 로드시 실행
      document.addEventListener('DOMContentLoaded', function() {
        // 1. 인기 게시글의 작은 카테고리 태그
        const categoryTags = document.querySelectorAll('.mainpage-post-tag');
        categoryTags.forEach(tag => {
          const categoryName = tag.textContent.trim();
          if (categoryColors[categoryName]) {
            tag.style.background = categoryColors[categoryName].bg;
            tag.style.boxShadow = `0 2px 8px ${categoryColors[categoryName].shadow}`;
          }
        });

        // 2. 카드 게시판의 카테고리 제목
        const boardCards = document.querySelectorAll('.mainpage-board-card');
        boardCards.forEach(card => {
          const titleElement = card.querySelector('.mainpage-board-card-title');
          if (titleElement) {
            const categoryName = titleElement.textContent.trim();
            if (categoryColors[categoryName]) {
              titleElement.style.color = categoryColors[categoryName].text;
              titleElement.style.background = `${categoryColors[categoryName].bg} left bottom no-repeat`;
              titleElement.style.backgroundSize = '100% 2px';
            }
          }
        });
      });

      // (현재 HTML에 toggleCategory 버튼이 없어서, 기존 코드 유지하면 불필요할 수 있음)
      const categoryPostsData = /*[[${categoryPosts}]]*/ {};

      function togglePosts() {
        const sections = document.querySelectorAll('.mainpage-top-section');
        const moreLink = document.querySelector('.mainpage-posts .mainpage-more-link');

        sections.forEach(section => {
          const items = section.querySelectorAll('.mainpage-top-item');

          if (items[1] && (items[1].style.display === 'none' || items[1].style.display === '')) {
            items.forEach(item => item.style.display = 'flex');
            moreLink.textContent = '접기 ↑';
          } else {
            items.forEach((item, index) => {
              if (index >= 1) item.style.display = 'none';
            });
            moreLink.textContent = '더보기 ↓';
          }
        });
      }

      window.onload = function () {
        const sections = document.querySelectorAll('.mainpage-top-section');
        sections.forEach(section => {
          const items = section.querySelectorAll('.mainpage-top-item');
          items.forEach((item, index) => {
            if (index >= 1) item.style.display = 'none';
          });
        });
      };
    </script>
  </body>
</html>
