<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ì»¤ë®¤ë‹ˆí‹° ë©”ì¸</title>
    <link rel="stylesheet" href="/communityCss/mainPage.css" />

    <!-- ì‚¬ê³¼ê²Œì„ ì ìˆ˜ìš© í°íŠ¸ -->
    <link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet" />

    <style>
      /* =========================
         Apple Game (Scoped)
      ========================= */

      /* âœ… í•µì‹¬: absolute ê¸°ì¤€ ì¡ê¸° + ì˜ë¦¼ ë°©ì§€ */
      .applegame{
        position: relative;            /* âœ… before/overlay/timeApple ê¸°ì¤€ */
        min-height: 980px;             /* âœ… ë” ë„‰ë„‰í•˜ê²Œ (ë°°ë„ˆë‘ ë¶™ëŠ” ë¬¸ì œ í•´ê²°) */
        padding: 24px 16px 44px;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        overflow: visible;             /* âœ… scoreLogs/top ìš”ì†Œ ì˜ë¦¼ ë°©ì§€ */
      }

      /* ë°°ê²½ ì› */
      .applegame::before{
        content:"";
        position:absolute;
        inset:-120px -120px auto auto;
        width: 420px;
        height: 420px;
        background: radial-gradient(circle at 30% 30%, rgba(214,244,255,0.9), transparent 60%);
        pointer-events:none;
        z-index: 0;
      }

      .applegame * { box-sizing: border-box; }

      .applegame h1{
        position: relative;
        z-index: 1;
        margin: 0 0 10px;
        text-align: center;
        color: #d35400;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.18);
        font-size: 28px;
      }

      .applegame-controls{
        position: relative;
        z-index: 1;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        gap: 12px;
        margin: 8px 0 14px;
      }

      .applegame #startBtn{
        padding: 10px 18px;
        font-size: 16px;
        background-color: #d35400;
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        box-shadow: 0 6px 14px rgba(211, 84, 0, 0.35);
        transition: background-color 0.3s ease, box-shadow 0.3s ease, transform .12s ease;
      }
      .applegame #startBtn:hover{
        background-color: #e67e22;
        box-shadow: 0 10px 22px rgba(230, 126, 34, 0.45);
        transform: translateY(-1px);
      }
      .applegame #startBtn:active{ transform: translateY(0); }

      .applegame #score{
        font-family: 'Do Hyeon', sans-serif;
        font-size: 22px;
        color: #e67e22;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.12);
        user-select: none;
        padding: 6px 12px;
        border-radius: 12px;
        background-color: #fff7e6;
        box-shadow: 0 10px 22px rgba(230,126,34,0.22);
        min-width: 140px;
        text-align: center;
      }

      .applegame #timerContainer{
        position: relative;
        width: 220px;
        height: 30px;
      }
      .applegame #timerBar{
        position: absolute;
        top: 50%;
        left: 0;
        transform: translateY(-50%);
        height: 12px;
        width: 100%;
        background-color: #eee;
        border-radius: 999px;
        overflow: hidden;
        box-shadow: inset 0 0 8px rgba(0,0,0,0.15);
      }
      .applegame #timerBarFill{
        height: 100%;
        width: 100%;
        background-color: #d35400;
        border-radius: 999px;
        transition: width 1s linear;
        box-shadow: 0 0 8px rgba(211, 84, 0, 0.55);
      }

      /* âœ… ë³´ë“œ ë˜í¼: ì—¬ê¸°ì„œ ë†’ì´ë¥¼ í™•ì‹¤íˆ í™•ë³´ */
      .applegame-board{
        position: relative;
        z-index: 1;
        width: 100%;
        display: flex;
        justify-content: center;
      }

      /* âœ… ì‹¤ì œ ê²Œì„ ë°•ìŠ¤(ì¹´ë“œ) */
      .applegame-board-inner{
        position: relative;                 /* âœ… overlay / scoreLogs ê¸°ì¤€ */
        width: max-content;
        margin: 0 auto;
        background: rgba(255,255,255,0.9);
        border: 1px solid rgba(15,23,42,0.10);
        border-radius: 18px;
        padding: 18px;
        box-shadow: 0 18px 50px rgba(15,23,42,0.12);
        overflow: visible;                  /* âœ… scoreLogsê°€ ìœ„ë¡œ íŠ€ì–´ë„ ì•ˆ ì˜ë¦¼ */
        min-height: 520px;                  /* âœ… í•µì‹¬: ë³´ë“œ ë†’ì´ í™•ë³´ */
      }

      /* âœ… game grid ìŠ¤íƒ€ì¼ ë³µêµ¬(ì´ê²Œ ë¹ ì ¸ìˆì–´ì„œ ë ˆì´ì•„ì›ƒì´ ê¹¨ì§ˆ ìˆ˜ ìˆìŒ) */
      .applegame #game{
        position: relative;
        width: max-content;
        margin: 0 auto;
        display: grid;
        grid-template-columns: repeat(17, 30px);
        gap: 5px;
        background-color: white;
        padding: 20px;
        border: 3px solid rgba(46, 204, 113, 0.75);
        border-radius: 16px;
        box-shadow: 0 10px 26px rgba(0,0,0,0.10);
        min-height: 420px;
      }

      .applegame .apple{
        position: relative;
        width: 30px;
        height: 30px;
        background-color: transparent;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: default;
        user-select: none;
        padding: 0;
        margin: 0;
        line-height: 1;
        transition: border 0.2s ease;
      }
      .applegame .apple::before{
        content: "ğŸ";
        position: absolute;
        top: 40%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 24px;
        pointer-events: none;
        z-index: 0;
        filter: drop-shadow(0 0 1px rgba(0,0,0,0.25));
      }
      .applegame .apple span{
        position: relative;
        z-index: 1;
        color: #fff;
        font-weight: 800;
        user-select: none;
        font-size: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        width: 100%;
        text-shadow: 0 1px 2px rgba(0,0,0,0.35);
      }

      .applegame #selectionBox{
        position: fixed;
        border: 2px dashed #d35400;
        background-color: rgba(255, 118, 117, 0.2);
        pointer-events: none;
        display: none;
        z-index: 1000;
      }

      @keyframes vanish{
        0% { transform: scale(1); opacity: 1; }
        100% { transform: scale(0); opacity: 0; }
      }
      .applegame .apple.vanish{ animation: vanish 0.5s forwards; }

      @keyframes logUpFade{
        0% { opacity: 1; transform: translateY(20px); }
        100% { opacity: 0; transform: translateY(-30px); }
      }

      /* âœ… scoreLogs: ë¶€ëª¨(.applegame-board-inner)ê°€ relative + overflow visibleì´ë¯€ë¡œ ì•ˆ ì˜ë¦¼ */
      .applegame #scoreLogs{
        position: absolute;
        top: -62px;
        right: 0;
        width: 140px;
        max-height: 180px;
        pointer-events: none;
        z-index: 2000;
        font-weight: bold;
        font-size: 20px;
        display: flex;
        flex-direction: column-reverse;
        gap: 6px;
        text-align: right;
      }

      .applegame .scoreLogItem{
        background: rgba(39, 174, 96, 0.10);
        border: 1px solid rgba(39, 174, 96, 0.55);
        border-radius: 10px;
        padding: 4px 10px;
        user-select: none;
        animation: logUpFade 1.2s forwards;
        color: #27ae60;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: 6px;
        white-space: nowrap;
      }
      .applegame .scoreLogItem.blue{
        background: rgba(41, 128, 185, 0.12);
        border: 1px solid rgba(41, 128, 185, 0.55);
        color: #2980b9;
      }
      .applegame .scoreLogPoints{ font-size: 22px; min-width: 48px; text-align: right; }
      .applegame .scoreLogApple{ font-size: 26px; line-height: 1; user-select: none; }

      .applegame .apple.selected{
        border: 8px solid #00ff22;
        box-sizing: border-box;
      }

      @keyframes timeAppleUp { 0% { bottom: 10px; opacity: 1; } 100% { bottom: 90%; opacity: 0; } }
      @keyframes timeAppleDown { 0% { top: 10px; opacity: 1; } 100% { top: 90%; opacity: 0; } }
      @keyframes growAndFade { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(2.5); opacity: 0; } }
      .applegame .growFade { animation: growAndFade 0.6s forwards; }

      /* âœ… ì´ˆê¸° ì•ˆë‚´ ì˜¤ë²„ë ˆì´(ì„œë¹„ìŠ¤ ëŠë‚Œ) */
      .applegame-overlay{
        position: absolute;
        inset: 0;
        display: grid;
        place-items: center;
        z-index: 5000;
        padding: 16px;
        background: radial-gradient(1200px 600px at 15% 10%, rgba(37,99,235,0.16), transparent 55%),
                    radial-gradient(900px 500px at 90% 20%, rgba(16,185,129,0.14), transparent 55%),
                    rgba(255,255,255,0.55);
        backdrop-filter: blur(10px);
        border-radius: 16px;
      }

      .applegame-overlay-card{
        width: min(620px, 100%);
        background: rgba(255,255,255,0.92);
        border: 1px solid rgba(15,23,42,0.10);
        border-radius: 18px;
        box-shadow: 0 18px 55px rgba(15,23,42,0.16);
        padding: 18px 18px 16px;
        text-align: left;
        position: relative;
        overflow: hidden;
      }

      .applegame-overlay-badge{
        display: inline-flex;
        align-items: center;
        height: 28px;
        padding: 0 12px;
        border-radius: 999px;
        background: rgba(37,99,235,0.10);
        border: 1px solid rgba(37,99,235,0.18);
        color: #1d4ed8;
        font-weight: 800;
        font-size: 13px;
      }

      .applegame-overlay-title{
        margin: 10px 0 8px;
        font-size: 20px;
        letter-spacing: -0.02em;
        color: rgba(15,23,42,0.92);
      }

      .applegame-overlay-desc{
        margin: 0 0 14px;
        color: rgba(15,23,42,0.72);
        font-weight: 600;
        line-height: 1.5;
      }

      .applegame-rulegrid{
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin: 10px 0 14px;
      }

      .applegame-rule{
        background: rgba(248,250,252,0.95);
        border: 1px solid rgba(15,23,42,0.08);
        border-radius: 14px;
        padding: 10px 12px;
      }

      .applegame-rule-k{
        font-size: 12px;
        color: rgba(15,23,42,0.55);
        font-weight: 800;
        margin-bottom: 6px;
      }

      .applegame-rule-v{
        font-size: 13px;
        color: rgba(15,23,42,0.82);
        font-weight: 700;
        line-height: 1.35;
      }

      .applegame-overlay-actions{
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        margin-top: 6px;
      }

      .applegame-overlay-primary{
        height: 42px;
        padding: 0 16px;
        border-radius: 12px;
        border: 1px solid rgba(37,99,235,0.25);
        background: linear-gradient(135deg, #2563eb, #1d4ed8);
        color: #fff;
        font-weight: 900;
        cursor: pointer;
        box-shadow: 0 14px 26px rgba(37,99,235,0.22);
        transition: transform .12s ease, box-shadow .12s ease;
      }
      .applegame-overlay-primary:hover{
        transform: translateY(-1px);
        box-shadow: 0 18px 34px rgba(37,99,235,0.30);
      }

      .applegame-overlay-ghost{
        height: 42px;
        padding: 0 14px;
        border-radius: 12px;
        border: 1px solid rgba(15,23,42,0.12);
        background: rgba(255,255,255,0.75);
        color: rgba(15,23,42,0.78);
        font-weight: 850;
        cursor: pointer;
      }

      .applegame-overlay-foot{
        margin-top: 10px;
        font-size: 12px;
        color: rgba(15,23,42,0.58);
        font-weight: 650;
      }

      @media (max-width: 520px){
        .applegame{ min-height: 920px; }
        .applegame #game{ grid-template-columns: repeat(17, 26px); gap: 4px; padding: 16px; }
        .applegame .apple{ width: 26px; height: 26px; }
        .applegame .apple::before{ font-size: 20px; }
      }
    </style>
  </head>

  <body>
    <th:block th:include="common/header"></th:block>

    <!-- ë©”ì¸ ë°°ë„ˆ ì˜ì—­ -->
    <section class="mainpage-banner">
      <div class="mainpage-banner-content">
        <h1>í•¨ê»˜ ì†Œí†µí•˜ê³  ì„±ì¥í•˜ëŠ” ì»¤ë®¤ë‹ˆí‹°</h1>
        <p>ë‹¤ì–‘í•œ ì£¼ì œë¡œ ëŒ€í™”í•˜ê³ , ì§€ì‹ì„ ê³µìœ í•˜ë©°, ìƒˆë¡œìš´ ì¹œêµ¬ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”</p>
        <div class="mainpage-banner-buttons">
          <button class="mainpage-btn-primary" onclick="location.href='/app/login'">ë¡œê·¸ì¸</button>
          <button class="mainpage-btn-secondary" onclick="location.href='/app/signup'">ì²˜ìŒì´ì‹ ê°€ìš”?</button>
        </div>
      </div>
    </section>

    <!-- ì»¤ë®¤ë‹ˆí‹° íŠ¹ì§• ì†Œê°œ -->
    <section class="mainpage-features">
      <h2>ì»¤ë®¤ë‹ˆí‹°ì˜ íŠ¹ì§•</h2>
      <div class="mainpage-feature-list">
        <div class="mainpage-feature-item">
          <div class="mainpage-feature-icon">ğŸ’¬</div>
          <h3>ììœ ë¡œìš´ ì†Œí†µ</h3>
          <p>ë‹¤ì–‘í•œ ì£¼ì œë¡œ ììœ ë¡­ê²Œ ëŒ€í™”í•˜ê³  ì˜ê²¬ì„ ë‚˜ëˆ ë³´ì„¸ìš”</p>
        </div>
        <div class="mainpage-feature-item">
          <div class="mainpage-feature-icon">ğŸ‘¥</div>
          <h3>í™œë°œí•œ ì»¤ë®¤ë‹ˆí‹°</h3>
          <p>í™œë°œí•˜ê²Œ ì§ˆë¬¸ê³¼ ë‹µë³€ ë“±ì„ ì˜¬ë¦¬ëŠ” ì»¤ë®¤ë‹ˆí‹°</p>
        </div>
        <div class="mainpage-feature-item">
          <div class="mainpage-feature-icon">ğŸ“ˆ</div>
          <h3>íŠ¸ë Œë”© ì½˜í…ì¸ </h3>
          <p>ì¸ê¸° ìˆëŠ” ê²Œì‹œê¸€ê³¼ í•«í•œ í† í”½ì„ ë§Œë“¤ì–´ìš”</p>
        </div>
      </div>
    </section>

    <!-- ì¸ê¸° ê²Œì‹œê¸€ ì˜ì—­ -->
    <section class="mainpage-posts">
      <div class="mainpage-posts-header">
        <h2>ì¸ê¸° ê²Œì‹œê¸€</h2>
        <a href="javascript:void(0);" class="mainpage-more-link" onclick="togglePosts()">ë”ë³´ê¸° â†“</a>
      </div>

      <div class="mainpage-top-container">
        <div class="mainpage-top-section">
          <h3 class="mainpage-section-title">ğŸ‘ ì¡°íšŒìˆ˜ TOP</h3>
          <div class="mainpage-top-list">
            <div class="mainpage-top-item"
                 th:each="post, stat : ${viewTopPosts}"
                 th:onclick="|location.href='/board/postDetail/' + ${post.postId}|"
                 style="cursor: pointer;">
              <span class="mainpage-rank" th:text="${stat.index + 1}">1</span>
              <div class="mainpage-item-content">
                <span class="mainpage-post-tag" th:text="${post.categoryName}">ììœ </span>
                <h4 th:text="${post.title}">ì œëª©</h4>
                <div class="mainpage-post-info">
                  <span th:text="${post.nickname}">ì‘ì„±ì</span>
                  <span th:text="'ğŸ‘ ' + ${post.viewCount}">ì¡°íšŒìˆ˜</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="mainpage-top-section">
          <h3 class="mainpage-section-title">â¤ ì¢‹ì•„ìš” TOP</h3>
          <div class="mainpage-top-list">
            <div class="mainpage-top-item"
                 th:each="post, stat : ${likeTopPosts}"
                 th:onclick="|location.href='/board/postDetail/' + ${post.postId}|"
                 style="cursor: pointer;">
              <span class="mainpage-rank" th:text="${stat.index + 1}">1</span>
              <div class="mainpage-item-content">
                <span class="mainpage-post-tag" th:text="${post.categoryName}">ììœ </span>
                <h4 th:text="${post.title}">ì œëª©</h4>
                <div class="mainpage-post-info">
                  <span th:text="${post.nickname}">ì‘ì„±ì</span>
                  <span th:text="'â¤ ' + ${post.likeCount}">ì¢‹ì•„ìš”</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="mainpage-top-section">
          <h3 class="mainpage-section-title">ğŸ’¬ ëŒ“ê¸€ TOP</h3>
          <div class="mainpage-top-list">
            <div class="mainpage-top-item"
                 th:each="post, stat : ${commentTopPosts}"
                 th:onclick="|location.href='/board/postDetail/' + ${post.postId}|"
                 style="cursor: pointer;">
              <span class="mainpage-rank" th:text="${stat.index + 1}">1</span>
              <div class="mainpage-item-content">
                <span class="mainpage-post-tag" th:text="${post.categoryName}">ììœ </span>
                <h4 th:text="${post.title}">ì œëª©</h4>
                <div class="mainpage-post-info">
                  <span th:text="${post.nickname}">ì‘ì„±ì</span>
                  <span th:text="'ğŸ’¬ ' + ${post.commentCount}">ëŒ“ê¸€</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ê³µì§€ì‚¬í•­ ì˜ì—­ -->
    <section class="mainpage-notices">
      <div class="mainpage-notices-header">
        <h2>ê³µì§€ì‚¬í•­</h2>
        <a href="javascript:void(0);" class="mainpage-more-link" onclick="toggleNotices()">ë”ë³´ê¸° â†“</a>
      </div>

      <div class="mainpage-notice-list" id="noticeList">
        <div class="mainpage-notice-item"
             th:each="notice, stat : ${noticeList}"
             th:classappend="${stat.index >= 3} ? 'mainpage-notice-hidden' : ''">
          <span class="mainpage-notice-badge" th:text="${notice.noticeType}">ê³µì§€</span>
          <span class="mainpage-notice-title" th:text="${notice.title}">ì œëª©</span>
          <span class="mainpage-notice-date"
                th:text="${#dates.format(notice.createdAt, 'yyyy. MM. dd.')}">ë‚ ì§œ</span>
        </div>
      </div>
    </section>

    <!-- âœ… ì‚¬ê³¼ê²Œì„ ì„¹ì…˜ -->
    <section class="applegame" id="appleTop">
      <h1>ğŸ ì‚¬ê³¼ê²Œì„</h1>

      <div class="applegame-controls">
        <button id="startBtn" type="button">ê²Œì„ ì‹œì‘</button>
        <div id="score">Score : 0</div>
        <div id="timerContainer" aria-label="ë‚¨ì€ ì‹œê°„">
          <div id="timerBar">
            <div id="timerBarFill"></div>
          </div>
        </div>
      </div>

      <div class="applegame-board">
        <!-- âœ… ê²Œì„ ì¹´ë“œ(ì—¬ê¸° ê¸°ì¤€ìœ¼ë¡œ overlay/bonus/logê°€ ì¡í˜) -->
        <div class="applegame-board-inner">
          <!-- âœ… ì´ˆê¸° ì•ˆë‚´ ì˜¤ë²„ë ˆì´ -->
          <div id="gameOverlay" class="applegame-overlay" aria-live="polite">
            <div class="applegame-overlay-card">
              <div class="applegame-overlay-badge">10 ë§Œë“¤ê¸° í¼ì¦</div>
              <h2 class="applegame-overlay-title">ë“œë˜ê·¸ë¡œ ì‚¬ê³¼ë¥¼ ì„ íƒí•´ì„œ í•©ì´ 10ì´ë©´ ì œê±°!</h2>
              <p class="applegame-overlay-desc">
                ìˆ«ìê°€ ì íŒ ì‚¬ê³¼ë“¤ì„ <b>ë“œë˜ê·¸</b>ë¡œ ì˜ì—­ ì„ íƒí•˜ì„¸ìš”.<br />
                ì„ íƒí•œ ì‚¬ê³¼ ìˆ«ìì˜ <b>í•©ì´ 10</b>ì´ë©´ ì‚¬ê³¼ê°€ ì‚¬ë¼ì§€ê³  ì ìˆ˜ë¥¼ ì–»ìŠµë‹ˆë‹¤.
              </p>

              <div class="applegame-rulegrid">
                <div class="applegame-rule">
                  <div class="applegame-rule-k">ì¡°ì‘</div>
                  <div class="applegame-rule-v">ë§ˆìš°ìŠ¤ ë“œë˜ê·¸(ì¢Œí´ë¦­)ë¡œ ì˜ì—­ ì„ íƒ</div>
                </div>
                <div class="applegame-rule">
                  <div class="applegame-rule-k">ì ìˆ˜</div>
                  <div class="applegame-rule-v">ì œê±°í•œ ê°œìˆ˜ì˜ <b>ì œê³±</b> (ì˜ˆ: 3ê°œ â†’ 9ì )</div>
                </div>
                <div class="applegame-rule">
                  <div class="applegame-rule-k">ì‹œê°„</div>
                  <div class="applegame-rule-v"><b>120ì´ˆ</b> ì œí•œ</div>
                </div>
                <div class="applegame-rule">
                  <div class="applegame-rule-k">ë³´ë„ˆìŠ¤</div>
                  <div class="applegame-rule-v">ğŸ+3 ì‚¬ê³¼ í´ë¦­ ì‹œ <b>3ì </b> íšë“</div>
                </div>
              </div>

              <div class="applegame-overlay-actions">
                <button id="overlayStartBtn" type="button" class="applegame-overlay-primary">ê²Œì„ ì‹œì‘</button>
                <button id="overlayHowBtn" type="button" class="applegame-overlay-ghost">í•œ ë²ˆ ë” ì„¤ëª…</button>
              </div>

              <div class="applegame-overlay-foot">
                íŒ: ë§ì€ ê°œìˆ˜ë¥¼ í•œ ë²ˆì— ë§ì¶”ë©´ ì ìˆ˜ê°€ í¬ê²Œ ì˜¬ë¼ê°€ìš”.
              </div>
            </div>
          </div>

          <div id="game" aria-label="ê²Œì„ ë³´ë“œ">
            <div id="scoreLogs"></div>
          </div>

          <div id="selectionBox"></div>
        </div>
      </div>
    </section>

    <!-- í•˜ë‹¨ ë°°ë„ˆ -->
    <section class="mainpage-bottom-banner">
      <div class="mainpage-bottom-content">
        <h2>ì§€ê¸ˆ ë°”ë¡œ ì»¤ë®¤ë‹ˆí‹°ì— ì°¸ì—¬í•˜ì„¸ìš”</h2>
        <p>ë¬´ë£Œë¡œ ê°€ì…í•˜ê³  ë‹¤ì–‘í•œ ì‚¬ëŒë“¤ê³¼ ì†Œí†µí•´ë³´ì„¸ìš”</p>
        <button class="mainpage-btn-join" onclick="location.href='/app/signup'">íšŒì›ê°€ì…</button>
      </div>
    </section>

    <th:block th:include="common/footer"></th:block>

    <script>
      /* =========================
         ë©”ì¸ í˜ì´ì§€ í† ê¸€
      ========================= */
      function togglePosts() {
        const sections = document.querySelectorAll('.mainpage-top-section');
        const moreLink = document.querySelector('.mainpage-posts .mainpage-more-link');

        sections.forEach(section => {
          const items = section.querySelectorAll('.mainpage-top-item');

          if (items[1] && (items[1].style.display === 'none' || items[1].style.display === '')) {
            items.forEach(item => item.style.display = 'flex');
            moreLink.textContent = 'ì ‘ê¸° â†‘';
          } else {
            items.forEach((item, index) => {
              if (index >= 1) item.style.display = 'none';
            });
            moreLink.textContent = 'ë”ë³´ê¸° â†“';
          }
        });
      }

      function toggleNotices() {
        const hiddenNotices = document.querySelectorAll('.mainpage-notice-hidden');
        const moreLink = document.querySelector('.mainpage-notices .mainpage-more-link');

        if (!hiddenNotices.length) return;

        if (hiddenNotices[0].style.display === 'none' || hiddenNotices[0].style.display === '') {
          hiddenNotices.forEach((notice) => notice.style.display = 'flex');
          moreLink.textContent = 'ì ‘ê¸° â†‘';
        } else {
          hiddenNotices.forEach((notice) => notice.style.display = 'none');
          moreLink.textContent = 'ë”ë³´ê¸° â†“';
        }
      }

      /* =========================
         ì‚¬ê³¼ê²Œì„ ë¡œì§ (ì„œë¹„ìŠ¤í˜• ì˜¤ë²„ë ˆì´ í¬í•¨)
      ========================= */
      (function(){
        const game = document.getElementById('game');
        const scoreDisplay = document.getElementById('score');
        const timerBarFill = document.getElementById('timerBarFill');
        const startBtn = document.getElementById('startBtn');

        const overlay = document.getElementById('gameOverlay');
        const overlayStartBtn = document.getElementById('overlayStartBtn');
        const overlayHowBtn = document.getElementById('overlayHowBtn');

        const selectionBox = document.getElementById('selectionBox');
        const scoreLogs = document.getElementById('scoreLogs');

        const COLS = 17;
        const ROWS = 10;

        let score = 0;
        let timeLeft = 120;
        let timer;

        let startX = 0, startY = 0;
        let isDragging = false;

        let applesGrid = [];
        let currentSelected = [];
        let isGameRunning = false;

        // âœ… ë³´ë„ˆìŠ¤ ì‚¬ê³¼ ì»¨í…Œì´ë„ˆ: ë³´ë“œ ì¹´ë“œ ì•ˆì— ë¶™ì´ê¸°(ì˜ë¦¼/ìœ„ì¹˜ ì•ˆì •)
        const boardInner = document.querySelector('.applegame-board-inner');
        const timeAppleContainer = document.createElement('div');
        timeAppleContainer.style.position = 'absolute';
        timeAppleContainer.style.inset = '0';
        timeAppleContainer.style.pointerEvents = 'none';
        timeAppleContainer.style.zIndex = '4500';
        boardInner.appendChild(timeAppleContainer);

        function showOverlay(mode, finalScore){
          overlay.style.display = 'grid';

          const title = overlay.querySelector('.applegame-overlay-title');
          const desc = overlay.querySelector('.applegame-overlay-desc');
          const badge = overlay.querySelector('.applegame-overlay-badge');
          const foot = overlay.querySelector('.applegame-overlay-foot');

          if(mode === 'end'){
            badge.textContent = 'ê²Œì„ ì¢…ë£Œ';
            title.textContent = `ìµœì¢… ì ìˆ˜: ${finalScore}ì `;
            desc.innerHTML = `ë‹¤ì‹œ í•œ ë²ˆ ë„ì „í•´ë³¼ê¹Œìš”?<br/>ë” í¬ê²Œ ë¬¶ì„ìˆ˜ë¡ ì ìˆ˜ê°€ ì œê³±ìœ¼ë¡œ ì˜¬ë¼ê°€ìš”!`;
            foot.textContent = 'íŒ: 4ê°œ(16ì ), 5ê°œ(25ì )ì²˜ëŸ¼ í¬ê²Œ ë§ì¶”ë©´ ì ìˆ˜ í­ë°œ';
            overlayStartBtn.textContent = 'ë‹¤ì‹œ í•˜ê¸°';
          }else{
            badge.textContent = '10 ë§Œë“¤ê¸° í¼ì¦';
            title.textContent = 'ë“œë˜ê·¸ë¡œ ì‚¬ê³¼ë¥¼ ì„ íƒí•´ì„œ í•©ì´ 10ì´ë©´ ì œê±°!';
            desc.innerHTML = `ìˆ«ìê°€ ì íŒ ì‚¬ê³¼ë“¤ì„ <b>ë“œë˜ê·¸</b>ë¡œ ì˜ì—­ ì„ íƒí•˜ì„¸ìš”.<br/>ì„ íƒí•œ ì‚¬ê³¼ ìˆ«ìì˜ <b>í•©ì´ 10</b>ì´ë©´ ì‚¬ê³¼ê°€ ì‚¬ë¼ì§€ê³  ì ìˆ˜ë¥¼ ì–»ìŠµë‹ˆë‹¤.`;
            foot.textContent = 'íŒ: ë§ì€ ê°œìˆ˜ë¥¼ í•œ ë²ˆì— ë§ì¶”ë©´ ì ìˆ˜ê°€ í¬ê²Œ ì˜¬ë¼ê°€ìš”.';
            overlayStartBtn.textContent = 'ê²Œì„ ì‹œì‘';
          }
        }

        function hideOverlay(){
          overlay.style.display = 'none';
        }

        function generateApple(value) {
          const apple = document.createElement('div');
          apple.className = 'apple';
          apple.dataset.value = value;

          const span = document.createElement('span');
          span.textContent = value;
          apple.appendChild(span);

          return apple;
        }

        function renderGrid() {
          const keepLogs = scoreLogs;
          game.innerHTML = '';

          for (let r = 0; r < ROWS; r++) {
            for (let c = 0; c < COLS; c++) {
              const apple = applesGrid[r][c];
              if (apple) {
                game.appendChild(apple);
              } else {
                const empty = document.createElement('div');
                empty.style.width = '30px';
                empty.style.height = '30px';
                game.appendChild(empty);
              }
            }
          }

          if (!game.contains(keepLogs)) game.appendChild(keepLogs);
        }

        function addScoreLog(points) {
          if(points <= 0) return;

          const logItem = document.createElement('div');
          logItem.className = 'scoreLogItem';
          if (points >= 6) logItem.classList.add('blue');

          logItem.innerHTML =
            `<span class="scoreLogPoints">+${points}</span>` +
            `<span class="scoreLogApple">ğŸ</span>`;

          scoreLogs.appendChild(logItem);
          logItem.addEventListener('animationend', () => logItem.remove());

          if(scoreLogs.children.length > 5) {
            scoreLogs.removeChild(scoreLogs.firstChild);
          }
        }

        function updateScore() {
          scoreDisplay.textContent = 'Score : ' + score;
        }

        function updateTimerBar() {
          const percent = Math.max(0, (timeLeft / 120) * 100);
          timerBarFill.style.width = percent + '%';
        }

        function clearSelectedBorders() {
          currentSelected.forEach(({apple}) => apple.classList.remove('selected'));
          currentSelected = [];
        }

        function updateSelectedApples(boxLeft, boxTop, boxRight, boxBottom) {
          clearSelectedBorders();
          let newlySelected = [];

          for (let r = 0; r < ROWS; r++) {
            for (let c = 0; c < COLS; c++) {
              const apple = applesGrid[r][c];
              if (!apple) continue;

              const rect = apple.getBoundingClientRect();
              const isOverlap = !(rect.right < boxLeft || rect.left > boxRight || rect.bottom < boxTop || rect.top > boxBottom);

              if (isOverlap) {
                apple.classList.add('selected');
                newlySelected.push({ r, c, apple });
              }
            }
          }

          currentSelected = newlySelected;
        }

        function startGame() {
          hideOverlay();

          applesGrid = [];
          score = 0;
          timeLeft = 120;
          updateScore();
          updateTimerBar();
          scoreLogs.innerHTML = '';
          currentSelected = [];
          isGameRunning = true;

          for (let r = 0; r < ROWS; r++) {
            applesGrid[r] = [];
            for (let c = 0; c < COLS; c++) {
              const rand = Math.floor(Math.random() * 9) + 1;
              applesGrid[r][c] = generateApple(rand);
            }
          }

          renderGrid();

          clearInterval(timer);
          timer = setInterval(() => {
            timeLeft--;
            updateTimerBar();
            if (timeLeft <= 0) {
              clearInterval(timer);
              isGameRunning = false;
              showOverlay("end", score);
            }
          }, 1000);

          if (window.timeAppleInterval) clearInterval(window.timeAppleInterval);
          window.timeAppleInterval = setInterval(createTimeApple, 10000);
        }

        function createTimeApple() {
          if (!isGameRunning) return;
          if (timeAppleContainer.childElementCount >= 3) return;

          const apple = document.createElement('div');
          apple.textContent = 'ğŸ +3';
          apple.style.position = 'absolute';
          apple.style.fontSize = '46px';
          apple.style.cursor = 'pointer';
          apple.style.userSelect = 'none';
          apple.style.color = '#d35400';
          apple.style.fontWeight = '900';
          apple.style.filter = 'drop-shadow(0 0 1px rgba(0,0,0,0.3))';
          apple.style.pointerEvents = 'auto';
          apple.style.zIndex = '4600';

          const side = Math.random() < 0.5 ? 'left' : 'right';
          const fromTop = Math.random() < 0.5;

          if (side === 'left') apple.style.left = '10px';
          else apple.style.right = '10px';

          if (fromTop) {
            apple.style.top = '10px';
            apple.style.animation = `timeAppleDown 4s linear forwards`;
          } else {
            apple.style.bottom = '10px';
            apple.style.animation = `timeAppleUp 4s linear forwards`;
          }

          apple.addEventListener('animationend', () => {
            if (apple.parentNode) timeAppleContainer.removeChild(apple);
          });

          apple.addEventListener('click', (e) => {
            if (!isGameRunning) return;
            e.stopPropagation();
            score += 3;
            updateScore();
            addScoreLog(3);

            apple.style.animation = '';
            apple.style.pointerEvents = 'none';
            apple.classList.add('growFade');

            setTimeout(() => {
              if (apple.parentNode) timeAppleContainer.removeChild(apple);
            }, 600);
          });

          timeAppleContainer.appendChild(apple);
        }

        game.addEventListener('mousedown', (e) => {
          if (!isGameRunning) return;
          if (e.button !== 0) return;

          isDragging = true;
          startX = e.clientX;
          startY = e.clientY;

          selectionBox.style.left = startX + 'px';
          selectionBox.style.top = startY + 'px';
          selectionBox.style.width = '0px';
          selectionBox.style.height = '0px';
          selectionBox.style.display = 'block';
        });

        window.addEventListener('mousemove', (e) => {
          if (!isDragging) return;

          const currentX = e.clientX;
          const currentY = e.clientY;

          const x = Math.min(startX, currentX);
          const y = Math.min(startY, currentY);
          const width = Math.abs(startX - currentX);
          const height = Math.abs(startY - currentY);

          selectionBox.style.left = x + 'px';
          selectionBox.style.top = y + 'px';
          selectionBox.style.width = width + 'px';
          selectionBox.style.height = height + 'px';

          updateSelectedApples(x, y, x + width, y + height);
        });

        window.addEventListener('mouseup', () => {
          if (!isGameRunning) return;
          if (!isDragging) return;

          isDragging = false;
          selectionBox.style.display = 'none';

          const selected = currentSelected;
          const sum = selected.reduce((acc, obj) => acc + parseInt(obj.apple.dataset.value), 0);

          if (sum === 10 && selected.length > 0) {
            const points = selected.length ** 2;
            score += points;
            updateScore();
            addScoreLog(points);

            selected.forEach(({ r, c, apple }) => {
              apple.classList.add('vanish');
              apple.addEventListener('animationend', () => {
                applesGrid[r][c] = null;
                renderGrid();
              }, { once: true });
            });
          }

          clearSelectedBorders();
        });

        startBtn.addEventListener('click', () => startGame());
        overlayStartBtn.addEventListener('click', () => startGame());
        overlayHowBtn.addEventListener('click', () => showOverlay("intro", 0));

        showOverlay("intro", 0);
        updateTimerBar();
        updateScore();
      })();

      window.onload = function () {
        const sections = document.querySelectorAll('.mainpage-top-section');
        sections.forEach(section => {
          const items = section.querySelectorAll('.mainpage-top-item');
          items.forEach((item, index) => {
            if (index >= 1) item.style.display = 'none';
          });
        });

        const hiddenNotices = document.querySelectorAll('.mainpage-notice-hidden');
        hiddenNotices.forEach((notice) => {
          notice.style.display = 'none';
        });
      };
    </script>
  </body>
</html>
