<!-- boardList.html (ì „ì²´) -->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ê²Œì‹œíŒ</title>
<link rel="stylesheet" th:href="@{/communityCss/boardList.css}" />

<!-- âœ… ì¶”ê°€ CSS (ì¸ë„¤ì¼/ì•„ì´ì½˜/í˜¸ë²„í”„ë¦¬ë·° + ì¢Œ/ìš° ê´‘ê³ ) -->
<style>
/* =========================
     ì¹´ë“œ ì¸ë„¤ì¼ (ê³µí†µ)
  ========================= */
.bl-card-thumb {
	width: 100%;
	height: 160px;
	border-radius: 12px;
	overflow: hidden;
	background: rgba(15, 23, 42, 0.04);
	border: 1px solid rgba(15, 23, 42, 0.08);
	margin: 10px 0 12px;
	display: flex;
	align-items: center;
	justify-content: center;
}

/* ê¸°ë³¸ ì¸ë„¤ì¼: ë¹„ìœ¨ ìœ ì§€ (ì•ˆ ì˜ë¦¬ê²Œ) */
.bl-card-thumb img {
	width: 100%;
	height: 100%;
	object-fit: contain;
	object-position: center;
	display: block;
	background: transparent;
}

.bl-card-thumb--empty {
	font-size: 13px;
	font-weight: 800;
	color: rgba(15, 23, 42, 0.45);
}

/* ë¦¬ìŠ¤íŠ¸ ì œëª© ì˜† ì´ë¯¸ì§€ ì•„ì´ì½˜ */
.bl-hasimg {
	display: inline-flex;
	align-items: center;
	gap: 6px;
	margin-left: 8px;
	font-size: 12px;
	font-weight: 900;
	color: rgba(37, 99, 235, 0.95);
	vertical-align: middle;
}

.bl-hasimg .bl-hasimg-ico {
	font-size: 14px;
	line-height: 1;
}

/* =========================
     hover í”„ë¦¬ë·° íˆ´íŒ
  ========================= */
.bl-imgtip {
	position: fixed;
	z-index: 9999;
	width: 240px;
	height: 180px;
	border-radius: 14px;
	overflow: hidden;
	background: #fff;
	border: 1px solid rgba(15, 23, 42, 0.12);
	box-shadow: 0 18px 40px rgba(0, 0, 0, 0.18);
	display: none;
	pointer-events: none;
}

.bl-imgtip img {
	width: 100%;
	height: 100%;
	object-fit: contain;
	object-position: center;
	display: block;
	background: #fff;
}

/* =========================
     ì¹´ë“œ ë·°: ì˜¤ë¥¸ìª½ ì¸ë„¤ì¼ ê³ ì • ë°°ì¹˜
  ========================= */
.bl-view-card .bl-card-link {
	display: grid;
	grid-template-columns: 1fr 260px;
	grid-template-areas: "title  thumb" "desc   thumb" "bottom thumb";
	gap: 10px 16px;
	text-decoration: none;
}

/* âœ… í•µì‹¬ ìˆ˜ì • í¬ì¸íŠ¸
     height:100% ì œê±° â†’ ê³ ì • ë†’ì´ë¡œ ì œí•œ */
.bl-view-card .bl-card-thumb {
  grid-area: thumb;
  width: 100%;
  aspect-ratio: 16 / 9;   /* âœ… ê°€ë¡œ ê¸°ì¤€ ë¹„ìœ¨ */
  height: auto;           /* âŒ ê³ ì • height ì œê±° */
  margin: 0;
  align-self: start;
}

/* ì¹´ë“œ ë·°ì—ì„œëŠ” ê½‰ ì°¨ê²Œ */
.bl-view-card .bl-card-thumb img {
  width: 100%;
  height: 100%;
  object-fit: contain;     /* âœ… cover -> contain */
  object-position: center;
  display: block;
  background: rgba(15,23,42,0.04); /* âœ… ì—¬ë°± ìƒê¸°ë©´ ìì—°ìŠ¤ëŸ½ê²Œ */
}
.bl-view-card .bl-card-title {
	grid-area: title;
	margin: 0;
}

.bl-view-card .bl-card-desc {
	grid-area: desc;
	margin: 0;
}

.bl-view-card .bl-card-bottom {
	grid-area: bottom;
	margin-top: 4px;
}

/* =========================
     ë°˜ì‘í˜•
  ========================= */
@media ( max-width : 860px) {
	.bl-view-card .bl-card-link {
		grid-template-columns: 1fr;
		grid-template-areas: "thumb" "title" "desc" "bottom";
	}
	.bl-view-card .bl-card-thumb {
		height: 180px;
		min-height: 180px;
		max-height: 180px;
	}
}

/* =========================
   âœ… ì¢Œ/ìš° ì‚¬ì´ë“œ ê´‘ê³  (PC ì „ìš©)
   - bl-wrap max-width: 1120px ê¸°ì¤€ìœ¼ë¡œ calc ì •ë ¬
========================= */
.ad-side{
  position: fixed;
  top: 110px;                 /* í—¤ë” ë†’ì´ì— ë§ì¶° ì¡°ì ˆ */
  width: 180px;               /* ê´‘ê³  í­ */
  z-index: 60;
}

.ad-side--left{
  left: calc(50% - (1120px / 2) - 200px);
}

.ad-side--right{
  left: calc(50% + (1120px / 2) + 20px);
}

.ad-box{
  position: sticky;           /* ìŠ¤í¬ë¡¤ ë”°ë¼ ë‚´ë ¤ê°€ë„ ìì—°ìŠ¤ëŸ½ê²Œ */
  top: 110px;
  border-radius: 14px;
  border: 1px solid rgba(15,23,42,0.12);
  background: rgba(255,255,255,0.92);
  box-shadow: 0 14px 34px rgba(15,23,42,0.10);
  overflow: hidden;
  min-height: 320px;          /* ê´‘ê³  ìµœì†Œ ë†’ì´ */
  padding: 10px;
}

/* ì„ì‹œ í‘œì‹œìš©(ì›í•˜ë©´ ì§€ì›Œë„ ë¨) */
.ad-placeholder{
  height: 300px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius: 12px;
  border: 1px dashed rgba(15,23,42,0.18);
  color: rgba(15,23,42,0.45);
  font-weight: 900;
  letter-spacing: .02em;
  background: rgba(15,23,42,0.02);
}

/* í™”ë©´ ì¢ì•„ì§€ë©´ ìˆ¨ê¹€ (íƒœë¸”ë¦¿/ëª¨ë°”ì¼) */
@media (max-width: 1320px){
  .ad-side{ display:none; }
}

/* =========================
   âœ… ë¦¬ìŠ¤íŠ¸ NEW íƒœê·¸ ì˜ë¦¼ ë°©ì§€ (compact ì „ìš©)
   - line-height / overflow / ì •ë ¬ë§Œ ìµœì†Œ ìˆ˜ì •
========================= */

/* 1) ë§í¬/í–‰ì—ì„œ ì˜ë¦¬ëŠ” ê²½ìš°ê°€ ë§ì•„ì„œ ì•ˆì „ì¥ì¹˜ */
.bl-view-compact .bl-row-link{
  overflow: visible; /* ê¸°ì¡´ì´ hiddenì´ë©´ NEWê°€ ì˜ë ¤ë³´ì„ */
}

/* 2) ë©”íƒ€ ì˜ì—­ì„ ì„¸ë¡œ ì¤‘ì•™ì •ë ¬ + ë¼ì¸ë°•ìŠ¤ ì—¬ìœ  */
.bl-view-compact .bl-col-meta{
  display: flex;
  align-items: center;
  gap: 8px;
  min-height: 24px;   /* NEW ë°°ì§€ ë†’ì´ í™•ë³´ */
  line-height: 1.2;   /* ë¼ì¸ ë°•ìŠ¤ íƒ€ì´íŠ¸í•œê±° ì™„í™” */
  overflow: visible;
}

/* 3) ë‚ ì§œ + NEW ë˜í¼ë¥¼ inline-flexë¡œ ë°”ê¿”ì„œ ë°°ì§€ê°€ ì•ˆì •ì ìœ¼ë¡œ ë“¤ì–´ê°€ê²Œ */
.bl-view-compact .bl-datebox{
  display: inline-flex;
  align-items: center;
  gap: 6px;
  overflow: visible;
}

/* 4) NEW ìì²´ë¥¼ ë”± ë°°ì§€ì²˜ëŸ¼: ë†’ì´/íŒ¨ë”©/ë¼ì¸ ì•ˆì •í™” */
.bl-new.bl-new--sm{
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 2px 7px;
  border-radius: 999px;
  line-height: 1;
  transform: translateY(-1px); /* ì‚´ì§ ìœ„ë¡œ ì˜¬ë ¤ ë” ê¹”ë”í•˜ê²Œ(ì›í•˜ë©´ 0px) */
  white-space: nowrap;
}

</style>
</head>

<body>
	<th:block th:include="common/header"></th:block>

	<main class="bl-wrap">

    <!-- âœ… ì¢Œ/ìš° ê³ ì • ê´‘ê³  (PCì—ì„œë§Œ ë³´ì„) -->
    <aside class="ad-side ad-side--left" aria-label="ì™¼ìª½ ê´‘ê³ ">
      <div class="ad-box">
        <!-- ğŸ”» ì—¬ê¸°ì— ì‹¤ì œ ê´‘ê³  ì½”ë“œ ë„£ê¸° -->
        <div class="ad-placeholder">LEFT AD</div>
      </div>
    </aside>

    <aside class="ad-side ad-side--right" aria-label="ì˜¤ë¥¸ìª½ ê´‘ê³ ">
      <div class="ad-box">
        <!-- ğŸ”» ì—¬ê¸°ì— ì‹¤ì œ ê´‘ê³  ì½”ë“œ ë„£ê¸° -->
        <div class="ad-placeholder">RIGHT AD</div>
      </div>
    </aside>

		<section class="bl-head">
			<h1 class="bl-title">ê²Œì‹œíŒ</h1>
			<p class="bl-sub">ë‹¤ì–‘í•œ ì£¼ì œë¡œ ììœ ë¡­ê²Œ ì†Œí†µí•´ë³´ì„¸ìš”</p>
		</section>

		<!-- âœ… íˆ´ë°”: ê²€ìƒ‰ + ì •ë ¬ + ë³´ê¸°ë°©ì‹ + ê¸€ì“°ê¸° -->
		<section class="bl-toolbar">
			<form class="bl-search" method="get" th:action="@{/board}"
				id="boardSearchForm">
				<input type="hidden" name="categoryId"
					th:value="${selectedCategoryId}" /> <input type="hidden"
					name="page" value="1" />

				<div class="bl-searchbox">
					<input class="bl-search-input" type="text" name="q"
						placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" th:value="${q}" />
					<button class="bl-search-btn" type="submit">ê²€ìƒ‰</button>
				</div>

				<div class="bl-sort" role="radiogroup" aria-label="ì •ë ¬">
					<label class="bl-pill"> <input type="radio" name="sort"
						value="LATEST" th:checked="${sort == 'LATEST'}"
						onchange="document.getElementById('boardSearchForm').submit()" />
						<span>ìµœì‹ ìˆœ</span>
					</label> <label class="bl-pill"> <input type="radio" name="sort"
						value="VIEWS" th:checked="${sort == 'VIEWS'}"
						onchange="document.getElementById('boardSearchForm').submit()" />
						<span>ì¡°íšŒìˆœ</span>
					</label> <label class="bl-pill"> <input type="radio" name="sort"
						value="LIKES" th:checked="${sort == 'LIKES'}"
						onchange="document.getElementById('boardSearchForm').submit()" />
						<span>ì¢‹ì•„ìš”ìˆœ</span>
					</label>
				</div>
			</form>

			<div class="bl-toolbar-right">
				<div class="bl-view-toggle" role="radiogroup" aria-label="ë³´ê¸° ë°©ì‹">
					<label class="bl-pill bl-pill--sm"> <input type="radio"
						name="viewMode" value="card" /> <span>ì¹´ë“œ</span>
					</label> <label class="bl-pill bl-pill--sm"> <input type="radio"
						name="viewMode" value="compact" checked /> <span>ë¦¬ìŠ¤íŠ¸</span>
					</label>
				</div>

				<div class="bl-write" th:if="${isAuthenticated}">
					<a class="bl-write-btn" href="/app/boardwrite">âœ ê¸€ì“°ê¸°</a>
				</div>
			</div>
		</section>

		<!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
		<section class="bl-tabs">
			<a class="bl-tab"
				th:classappend="${selectedCategoryId == null} ? ' is-active' : ''"
				th:href="@{/board(sort=${sort}, q=${q})}"> ì „ì²´ </a> <a class="bl-tab"
				th:each="c : ${categories}" th:text="${c.categoryName}"
				th:classappend="${selectedCategoryId != null and selectedCategoryId == c.categoryId} ? ' is-active' : ''"
				th:href="@{/board(categoryId=${c.categoryId}, sort=${sort}, q=${q})}">
			</a>
		</section>

		<!-- âœ… hover í”„ë¦¬ë·° tooltip -->
		<div class="bl-imgtip" id="blImgTip" aria-hidden="true">
			<img id="blImgTipImg" alt="preview" />
		</div>

		<!-- ëª©ë¡ -->
		<section class="bl-list" id="boardListRoot">
			<div class="bl-empty" th:if="${#lists.isEmpty(posts)}">ê²€ìƒ‰ ê²°ê³¼ê°€
				ì—†ìŠµë‹ˆë‹¤.</div>

			<!-- 1) ì¹´ë“œ ë·° -->
			<div class="bl-view bl-view-card" data-view="card"
				th:if="${not #lists.isEmpty(posts)}">
				<article class="bl-card"
					th:classappend="${p.authorName == nickname} ? ' is-mine' : ''"
					th:each="p : ${posts}">

					<div class="bl-card-top">
						<span class="bl-badge" th:text="${p.categoryName}">ì¹´í…Œê³ ë¦¬</span> <span
							class="bl-datebox"> <span class="bl-date"
							th:text="${#dates.format(p.createdAt, 'yyyy. MM. dd.')}"></span>
							<span class="bl-new"
							th:if="${#dates.format(p.createdAt,'yyyyMMdd') == #dates.format(#dates.createNow(),'yyyyMMdd')}">
								NEW </span>
						</span>
					</div>

					<a class="bl-card-link"
						th:href="@{/board/postDetail/{postId}(postId=${p.postId})}">
						<!-- âœ… ì¹´ë“œ ì¸ë„¤ì¼: ì²« ì´ë¯¸ì§€ or 'ì´ë¯¸ì§€ ì—†ìŒ' -->
						<div class="bl-card-thumb">
							<img th:if="${p.firstImageSaveName != null}"
								th:src="@{/uploads/{name}(name=${p.firstImageSaveName})}"
								alt="thumbnail" />
							<div class="bl-card-thumb--empty"
								th:if="${p.firstImageSaveName == null}">ì´ë¯¸ì§€ ì—†ìŒ</div>
						</div>

						<div class="bl-card-title" th:text="${p.title}">ì œëª©</div>
						<p class="bl-card-desc" th:text="${p.contentPreview}">ë³¸ë¬¸ ë¯¸ë¦¬ë³´ê¸°</p>

						<div class="bl-card-bottom">
							<span class="bl-author"> <span th:text="${p.authorName}">ì‘ì„±ì</span>
								<span class="bl-me" th:if="${p.authorName == nickname}">(ë‚˜)</span>
							</span>

							<div class="bl-metrics">
								<span class="bl-metric">ğŸ‘ <em th:text="${p.viewCount}">0</em></span>
								<span class="bl-metric">â™¡ <em th:text="${p.likeCount}">0</em></span>
								<span class="bl-metric">ğŸ’¬ <em
									th:text="${p.commentCount}">0</em></span>
							</div>
						</div>
					</a>

					<div class="bl-card-actions"
						th:if="${isAuthenticated and loginMemberId != null and loginMemberId == p.authorId}">
						<a class="bl-edit-btn"
							th:href="@{/app/boardEditePage/{postId}(postId=${p.postId})}">ìˆ˜ì •</a>
					</div>
				</article>
			</div>

			<!-- 2) ë¦¬ìŠ¤íŠ¸ ë·° -->
			<div class="bl-view bl-view-compact" data-view="compact"
				th:if="${not #lists.isEmpty(posts)}">
				<article class="bl-row"
					th:classappend="${p.authorName == nickname} ? ' is-mine' : ''"
					th:each="p : ${posts}">

					<!-- âœ… hover previewë¥¼ ìœ„í•´ dataset ë„£ì–´ë‘  -->
					<a class="bl-row-link"
						th:href="@{/board/postDetail/{postId}(postId=${p.postId})}"
						th:attr="data-img=${p.firstImageSaveName != null ? '/uploads/' + p.firstImageSaveName : ''}">

						<div class="bl-col-title">
							<span class="bl-badge" th:text="${p.categoryName}">ì¹´í…Œê³ ë¦¬</span> <span
								class="bl-title-text" th:text="${p.title}">ì œëª©</span>

							<!-- âœ… ì´ë¯¸ì§€ ìˆìœ¼ë©´ ì•„ì´ì½˜ í‘œì‹œ -->
							<span class="bl-hasimg" th:if="${p.firstImageSaveName != null}">
								<span class="bl-hasimg-ico">ğŸ–¼</span> <span
								class="bl-hasimg-txt">ì´ë¯¸ì§€</span>
							</span>
						</div>

						<div class="bl-col-meta">
							<span class="bl-author"> <span th:text="${p.authorName}">ì‘ì„±ì</span>
								<span class="bl-me" th:if="${p.authorName == nickname}">(ë‚˜)</span>
							</span> <span class="bl-dot">Â·</span> <span class="bl-datebox"> <span
								class="bl-date"
								th:text="${#dates.format(p.createdAt, 'yyyy.MM.dd')}"></span> <span
								class="bl-new bl-new--sm"
								th:if="${#dates.format(p.createdAt,'yyyyMMdd') == #dates.format(#dates.createNow(),'yyyyMMdd')}">
									NEW </span>
							</span>
						</div>

						<div class="bl-col-metrics">
							<span class="bl-metric">ğŸ‘ <em th:text="${p.viewCount}">0</em></span>
							<span class="bl-metric">â™¡ <em th:text="${p.likeCount}">0</em></span>
							<span class="bl-metric">ğŸ’¬ <em th:text="${p.commentCount}">0</em></span>
						</div>
					</a>

					<div class="bl-col-actions"
						th:if="${isAuthenticated and loginMemberId != null and loginMemberId == p.authorId}">
						<a class="bl-edit-btn"
							th:href="@{/app/boardEditePage/{postId}(postId=${p.postId})}">ìˆ˜ì •</a>
					</div>
				</article>
			</div>
		</section>

		<!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
		<section class="bl-pagination" th:if="${totalPages > 1}">
			<a class="bl-page-btn"
				th:classappend="${page == 1} ? ' is-disabled' : ''"
				th:href="${page == 1} ? '#' : @{/board(page=1, categoryId=${selectedCategoryId}, q=${q}, sort=${sort})}">
				ì²˜ìŒ </a> <a class="bl-page-btn"
				th:classappend="${page == 1} ? ' is-disabled' : ''"
				th:href="${page == 1} ? '#' : @{/board(page=${prevPage}, categoryId=${selectedCategoryId}, q=${q}, sort=${sort})}">
				ì´ì „ </a> <a class="bl-page-num"
				th:each="i : ${#numbers.sequence(startPage, endPage)}"
				th:text="${i}" th:classappend="${i == page} ? ' is-active' : ''"
				th:href="@{/board(page=${i}, categoryId=${selectedCategoryId}, q=${q}, sort=${sort})}">
			</a> <a class="bl-page-btn"
				th:classappend="${page == totalPages} ? ' is-disabled' : ''"
				th:href="${page == totalPages} ? '#' : @{/board(page=${nextPage}, categoryId=${selectedCategoryId}, q=${q}, sort=${sort})}">
				ë‹¤ìŒ </a> <a class="bl-page-btn"
				th:classappend="${page == totalPages} ? ' is-disabled' : ''"
				th:href="${page == totalPages} ? '#' : @{/board(page=${totalPages}, categoryId=${selectedCategoryId}, q=${q}, sort=${sort})}">
				ë </a>
		</section>
	</main>

	<th:block th:include="common/footer"></th:block>

	<script>
    (function () {
      const STORAGE_KEY = "board_view_mode";
      const root = document.getElementById("boardListRoot");
      if (!root) return;

      const radios = document.querySelectorAll('input[name="viewMode"]');
      const views = root.querySelectorAll(".bl-view");

      function normalize(mode) {
        return (mode === "compact" || mode === "card") ? mode : "compact";
      }

      function apply(modeRaw) {
        const mode = normalize(modeRaw);

        views.forEach(v => {
          const vMode = v.getAttribute("data-view");
          v.style.display = (vMode === mode) ? "block" : "none";
        });

        radios.forEach(r => (r.checked = (r.value === mode)));
        localStorage.setItem(STORAGE_KEY, mode);
      }

      const saved = localStorage.getItem(STORAGE_KEY);
      if (!saved) localStorage.setItem(STORAGE_KEY, "compact");
      apply(saved ?? "compact");

      radios.forEach(r => r.addEventListener("change", () => apply(r.value)));
    })();

    // âœ… ë¦¬ìŠ¤íŠ¸ hover ì´ë¯¸ì§€ í”„ë¦¬ë·°
    (function () {
      const tip = document.getElementById("blImgTip");
      const tipImg = document.getElementById("blImgTipImg");
      if (!tip || !tipImg) return;

      const OFFSET_X = 18;
      const OFFSET_Y = 18;

      function show(src, x, y) {
        tipImg.src = src;
        tip.style.left = (x + OFFSET_X) + "px";
        tip.style.top = (y + OFFSET_Y) + "px";
        tip.style.display = "block";
        tip.setAttribute("aria-hidden", "false");
      }

      function move(x, y) {
        tip.style.left = (x + OFFSET_X) + "px";
        tip.style.top = (y + OFFSET_Y) + "px";
      }

      function hide() {
        tip.style.display = "none";
        tip.setAttribute("aria-hidden", "true");
        tipImg.removeAttribute("src");
      }

      document.addEventListener("mouseover", (e) => {
        const link = e.target.closest(".bl-view-compact .bl-row-link");
        if (!link) return;

        const src = link.getAttribute("data-img") || "";
        if (!src) return;

        show(src, e.clientX, e.clientY);
      });

      document.addEventListener("mousemove", (e) => {
        if (tip.style.display !== "block") return;
        move(e.clientX, e.clientY);
      });

      document.addEventListener("mouseout", (e) => {
        const link = e.target.closest(".bl-view-compact .bl-row-link");
        if (!link) return;
        hide();
      });

      window.addEventListener("scroll", hide, { passive: true });
      window.addEventListener("blur", hide);
    })();
  </script>
</body>
</html>
